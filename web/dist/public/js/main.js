"use strict";requirejs.config({baseUrl:"./components",paths:{jquery:"./jquery/dist/jquery.min",knockout:"./knockout/dist/knockout","knockout.mapping":"../js/knockout.mapping.2.4.1.min",ReceivedOrders:"../js/received-orders",ReckoningOrders:"../js/reckoning-orders",IncomeList:"../js/income-list",Addresses:"../js/addresses",ItemsModel:"../js/purchase-items",swiper:"./swiper/dist/js/swiper.jquery.min",colorbox:"./jquery-colorbox/jquery.colorbox-min",tag:"../js/jquery.tag",angular:"./angular/angular.min",ngResource:"./angular-resource/angular-resource.min",ngAnimate:"./angular-animate/angular-animate.min","settings.component":"../js/settings/settings.min"},shim:{swiper:["jquery"],"knockout.mapping":["knockout"],colorbox:["jquery"],tag:["jquery"],angular:{exports:"angular"},ngResource:{deps:["angular"],exports:"angular"},ngAnimate:{deps:["angular"],exports:"angular"}}}),require(["ReceivedOrders","knockout","jquery","swiper"],function(e,n,t,o){function s(){0==p.activeIndex&&t.getJSON("./receivedOrdersJson",function(e,n){l.setOrders(e),setTimeout(function(){p.update()},100)}),2==p.activeIndex&&t.getJSON("./reckoningOrdersJson",function(e,n){var t=u.getObservableOrders(e);u.orders(t),setTimeout(function(){p.update()},100)})}function i(){0!=p.activeIndex&&t.getJSON("./receivedOrdersJson",function(e,n){l.setOrders(e),setTimeout(function(){p.update()},100)}),1!=p.activeIndex&&t.getJSON("./purchaseItemsJson",function(e,n){c.setItems(e.items,!0),setTimeout(function(){p.update()},100)}),2!=p.activeIndex&&t.getJSON("./reckoningOrdersJson",function(e,n){var t=u.getObservableOrders(e);u.orders(t),setTimeout(function(){p.update()},100)}),3!=p.activeIndex&&1!=p.activeIndex&&(t.getJSON("./incomeListJson",function(e,n){d.setIncomeList(e)}),setTimeout(function(){p.update()},100))}var r="ontouchstart"in document.documentElement?"touchstart":"click",a=t.fn.on;t.fn.on=function(){return arguments[0]="click"===arguments[0]?r:arguments[0],a.apply(this,arguments)},n.bindingHandlers.tap={init:function(e,n,o,r,a){var c=n();t(e).on("click",function(e){var n=t(e.target),o=t(".prompt-submitting"),r=t(".prompt-succeed"),u=t(".confirm");if(n.hasClass("action-delete")&&n.hasClass("action-submit")){var d=n.offset();t(".confirm-submit").one("click",function(){u.fadeOut("slow"),c(a.$data,a.$parent,e,function(){o.children("span").text("提交中...");var e=n.offset();t(".prompt").css("top",e.top).show()},function(){o.addClass("disappeared"),r.removeClass("disappeared"),t(".prompt").delay(600).fadeOut("slow",function(){o.removeClass("disappeared"),r.addClass("disappeared")}),i()})}),t(".confirm-cancel").one("click",function(){u.fadeOut("slow")}),t(".confirm").css("top",d.top).fadeIn("slow")}else if(n.hasClass("action-submit")){var l=t(document.activeElement);l.hasClass("action-submit")||l.blur(),setTimeout(function(){c(a.$data,a.$parent,e,function(){o.children("span").text("提交中...");var e=n.offset();t(".prompt").css("top",e.top).show()},function(e,n){o.addClass("disappeared"),r.removeClass("disappeared"),t(".prompt").delay(1200).fadeOut("slow",function(){o.removeClass("disappeared"),r.addClass("disappeared")}),n&&s(),e&&i()})},100)}else n.hasClass("action-load")?c(a.$data,a.$parent,e,function(){o.children("span").text("加载中...");var e=n.offset();t(".prompt").css("top",e.top).show()},function(){t(".prompt").delay(600).fadeOut("slow"),p.update()}):c(a.$data,a.$parent,e);return!1})},update:function(e,n,t,o,s){}};var c,u,d,p=new o(".swiper-container",{autoHeight:!0,spaceBetween:30,pagination:".swiper-pagination",paginationClickable:!0,simulateTouch:!1,shortSwipes:!1,longSwipes:!1,paginationBulletRender:function(e,n){var t="";switch(e){case 0:t="接单";break;case 1:t="采购";break;case 2:t="算账";break;case 3:t="收益"}return'<span class="'+n+'">'+t+"</span>"}}),l=new e(orders);n.applyBindings(l,t("#receivedOrders")[0]),l.setSwiper(p),require(["ItemsModel","ReckoningOrders","IncomeList","Addresses","knockout","jquery","tag"],function(e,n,t,o,s,r){var a=new Promise(function(n,t){r.getJSON("./purchaseItemsJson",function(t,o){c=new e(t.items,p),n(c),s.applyBindings(c,r("#purchaseItems")[0]);var a=new Promise(function(e,n){r.getJSON("./user/"+USER_ID,function(n,t){e(n)})});a.catch(function(e){}),a.then(function(e){var n=Array.isArray(e.tags)?e.tags:[];r(".hidden-tag").tag({tags:n,updateTag:function(e,n,t){if(Array.isArray(c.allItems)&&c.allItems.length>0){var o=c.allItems.find(function(n){return n._id==e});if(o.tag=t,o){var s=[];c.allItems.forEach(function(e){s.indexOf(e.tag)<0&&e.tag&&s.push(e.tag)}),c.tags(s)}}r.post("./itemtag",{itemName:e,oldTag:n,newTag:t},function(e,n){i()},"json")}})})})}),g=new Promise(function(e,t){r.getJSON("./reckoningOrdersJson",function(t,o){u=new n(t,p),e(u),s.applyBindings(u,r("#reckoningOrders")[0])})});Promise.all([a,g]).then(function(e){e[0].ordersModel=l,e[0].reckoningOrdersModel=e[1]}),r.getJSON("./incomeListJson",function(e,n){d=new t(e,p),s.applyBindings(d,r("#incomeList")[0])}),r(document).on("keydown",function(e){if(13==e.keyCode&&(0==p.activeIndex||2==p.activeIndex)){r(document.activeElement).blur();var n=0==p.activeIndex?"receivedOrders":"reckoningOrders",t=r("#"+n+" .action-enter");return setTimeout(function(){t.trigger("click")},100),!1}}),p.params.onSlideChangeStart=function(e){setTimeout(function(){r(window).scrollTop(0)},100)}}),require(["jquery","angular","settings.component","colorbox"],function(e,n){n.bootstrap(e("#settings")[0],["settings"]),e(".icon-cog").colorbox({inline:!0,width:335,height:200,scrolling:!1,close:"",top:0,onComplete:function(){setInterval(function(){e.colorbox.resize()},200)}}),e(window).scroll(function(){var n=e(window).scrollTop();e(".cogbox").css("top",n+10),e(".swiper-pagination").css("top",n),e(".searchbox").css("top",n)})})});
//# sourceMappingURL=main.js.map
