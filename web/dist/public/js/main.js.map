{"version":3,"sources":["public/js/main.js"],"names":["requirejs","config","baseUrl","jquery","paths","ReceivedOrders","ReckoningOrders","IncomeList","Addresses","ItemsModel","swiper","colorbox","shim","require","OrdersModel","ko","$","Swiper","isTouch","document","documentElement","on","fn","_on","arguments","apply","bindingHandlers","tap","init","element","valueAccessor","allBindings","viewModel","bindingContext","handler","event","$target","target","$submitting","$succeed","hasClass","offset","one","$confirm","fadeOut","$data","$parent","children","top","show","addClass","removeClass","delay","setTimeout","css","fadeIn","text","ordersModel","paginationBulletRender","index","className","bulletName","orders","applyBindings","autoHeight","spaceBetween","pagination","paginationClickable","simulateTouch","shortSwipes","longSwipes","setSwiper","window","scrollTop","scroll","IncomeListModel","AddressesModel","itemsModel","reckoningOrdersModel","incomeListModel","addressesModel","getJSON","rs","status","items","markedItems","trigger","onSlideChangeStart","incomeList","activeIndex","activeElement","observableOrders","update","targetPage","params","setOrders","width","setItems","getObservableOrders","iframe","doc","height","clientHeight","addresses","setAddresses","scrolling","close","setInterval","contentDocument","body","scrollHeight","resize"],"mappings":"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","file":"main.js","sourcesContent":["requirejs.config({\n\n    baseUrl: './components',\n\n    paths: {\n        jquery: 'jquery/dist/jquery.min',\n        'knockout': 'knockout/dist/knockout',\n        'knockout.mapping': '/js/knockout.mapping.2.4.1.min',\n        'ReceivedOrders': '/js/received-orders',\n        'ReckoningOrders': '/js/reckoning-orders',\n        'IncomeList': '/js/income-list',\n        'Addresses': '/js/addresses',\n        'ItemsModel': '/js/purchase-items',\n        'swiper': 'swiper/dist/js/swiper.jquery.min',\n        'colorbox': 'jquery-colorbox/jquery.colorbox-min'\n    },\n    shim: {\n        'swiper': ['jquery'],\n        'knockout.mapping': ['knockout'],\n        'colorbox': ['jquery']\n    }\n\n});\n\n\nrequire(['ReceivedOrders', 'knockout', 'jquery', 'swiper'], function(OrdersModel, ko, $, Swiper) {\n\n    var isTouch = ('ontouchstart' in document.documentElement) ? 'touchstart' : 'click';\n    var _on = $.fn.on;\n    $.fn.on = function() {\n        arguments[0] = (arguments[0] === 'click') ? isTouch : arguments[0];\n        return _on.apply(this, arguments);\n    }\n\n    ko.bindingHandlers.tap = {\n\n        init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {\n\n            var handler = valueAccessor();\n\n            $(element).on('click', function(event) {\n\n                var $target = $(event.target);\n                var $submitting = $('.prompt-submitting');\n                var $succeed = $('.prompt-succeed');\n                var $confirm = $('.confirm');\n\n                if ($target.hasClass('action-delete') && $target.hasClass('action-submit')) {\n                    var offset = $target.offset();\n\n                    $('.confirm-submit').one('click', function() {\n\n                        $confirm.fadeOut('slow');\n                        handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                            $submitting.children('span').text(\"Submitting...\");\n                            var offset = $target.offset();\n                            $('.prompt').css('top', offset.top).show();\n\n                        }, function() {\n\n                            $submitting.addClass('disappeared')\n                            $succeed.removeClass('disappeared')\n\n                            $('.prompt').delay(600).fadeOut('slow', function() {\n                                $submitting.removeClass('disappeared')\n                                $succeed.addClass('disappeared')\n                            });\n\n                        });\n\n                    })\n\n                    $('.confirm-cancel').one('click', function() {\n\n                        $confirm.fadeOut('slow');\n\n                    })\n\n                    $('.confirm').css('top', offset.top).fadeIn('slow');\n\n\n                } else if ($target.hasClass('action-submit')) {\n\n                    setTimeout(function() {\n\n                        handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                            $submitting.children('span').text(\"Submitting...\");\n                            var offset = $target.offset();\n                            $('.prompt').css('top', offset.top).show();\n\n                        }, function() {\n\n                            $submitting.addClass('disappeared')\n                            $succeed.removeClass('disappeared')\n\n\n                            $('.prompt').delay(1200).fadeOut('slow', function() {\n                                $submitting.removeClass('disappeared')\n                                $succeed.addClass('disappeared')\n\n                            });\n\n\n\n                        });\n\n\n                    }, 100);\n\n\n\n                } else if ($target.hasClass('action-load')) {\n\n                    handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                        $submitting.children('span').text(\"Loading...\");\n                        var offset = $target.offset();\n                        $('.prompt').css('top', offset.top).show();\n\n                    }, function() {\n\n                        $('.prompt').delay(600).fadeOut('slow');\n\n                    });\n\n                } else {\n                    handler(bindingContext.$data, bindingContext.$parent, event);\n\n\n                }\n                return false;\n            });\n\n\n        },\n        update: function(element, valueAccessor, allBindings, viewModel, bindingContext) {\n\n        }\n    }\n\n\n    var ordersModel = new OrdersModel(orders);\n    ko.applyBindings(ordersModel, $('#receivedOrders')[0]);\n\n    var swiper = new Swiper('.swiper-container', {\n        autoHeight: true,\n        spaceBetween: 30,\n        pagination: '.swiper-pagination',\n        paginationClickable: true,\n        simulateTouch: false,\n        shortSwipes: false,\n        longSwipes: false,\n        paginationBulletRender: function(index, className) {\n            var bulletName = '';\n            switch (index) {\n                case 0:\n\n                    bulletName = '接单';\n                    break;\n\n                case 1:\n                    bulletName = '采购';\n                    break;\n\n                case 2:\n                    bulletName = '算账';\n                    break;\n\n                case 3:\n                    bulletName = '收益';\n                    break;\n                    /* case 4:\n                         bulletName = 'Delivery';\n                         break;*/\n            }\n            return '<span class=\"' + className + '\">' + bulletName + '</span>';\n        }\n\n    });\n\n    ordersModel.setSwiper(swiper);\n\n    $(window).scroll(function() {\n        var top = $(window).scrollTop();\n        $(\".searchbox\").css(\"top\", top);\n\n    });\n\n\n    require(['ItemsModel', 'ReckoningOrders', 'IncomeList', 'Addresses', 'knockout', 'jquery'], function(ItemsModel, OrdersModel, IncomeListModel, AddressesModel, ko, $) {\n\n        var itemsModel, reckoningOrdersModel, incomeListModel, addressesModel;\n\n        $.getJSON('./purchaseItemsJson', function(rs, status) {\n\n            itemsModel = new ItemsModel(rs.items, rs.markedItems, swiper);\n            ko.applyBindings(itemsModel, $('#purchaseItems')[0]);\n\n        });\n\n\n        $.getJSON('./reckoningOrdersJson', function(orders, status) {\n            reckoningOrdersModel = new OrdersModel(orders, swiper);\n            ko.applyBindings(reckoningOrdersModel, $('#reckoningOrders')[0]);\n\n        });\n\n        $.getJSON('./incomeListJson', function(incomeList, status) {\n            incomeListModel = new IncomeListModel(incomeList, swiper);\n            ko.applyBindings(incomeListModel, $('#incomeList')[0]);\n\n        });\n\n        // $.getJSON('./addressesJson', function(addresses, status) {\n        //     addressesModel = new AddressesModel(addresses, swiper);\n        //     ko.applyBindings(addressesModel, $('#addresses')[0]);\n\n        // });\n\n        $(document).on('keydown', function(event) {\n            if (event.keyCode == 13 && (swiper.activeIndex == 0 || swiper.activeIndex == 2)) {\n                //var $target = $(document.activeElement).closest('.enterArea').find('.action-enter');\n                $(document.activeElement).blur();\n\n                var targetPage = swiper.activeIndex == 0 ? 'receivedOrders' : 'reckoningOrders'\n\n                var $target = $('#' + targetPage + ' .action-enter');\n                setTimeout(function() {\n                    $target.trigger('click')\n                }, 100);\n                return false;\n\n            }\n\n        });\n\n\n        swiper.params.onSlideChangeStart = function(swiper) {\n\n            switch (swiper.activeIndex) {\n                case 0:\n                    $.getJSON('./receivedOrdersJson', function(orders, status) {\n\n                        ordersModel.setOrders(orders);\n                        swiper.update();\n\n                    });\n                    break;\n                case 1:\n                    $.getJSON('./purchaseItemsJson', function(rs, status) {\n                        itemsModel.setItems(rs.items, rs.markedItems);\n                        swiper.update();\n\n                    });\n                    break;\n\n                case 2:\n                    $.getJSON('./reckoningOrdersJson', function(orders, status) {\n\n                        var observableOrders = reckoningOrdersModel.getObservableOrders(orders);\n                        reckoningOrdersModel.orders(observableOrders);\n                        swiper.update();\n\n                    })\n                    break;\n                case 3:\n                    $.getJSON('./incomeListJson', function(incomeList, status) {\n                        incomeListModel.setIncomeList(incomeList);\n                        swiper.update();\n\n                    })\n                    break;\n                case 4:\n                    $.getJSON('./addressesJson', function(addresses, status) {\n                        addressesModel.setAddresses(addresses);\n                        swiper.update();\n\n                    })\n                    break;\n            }\n            $(window).scrollTop(0);\n\n\n        }\n\n\n    });\n\n\n    require(['jquery', 'colorbox'], function($, colorbox) {\n\n        $('.icon-cog').colorbox({\n            iframe: true,\n            width: 335,\n            height: 200,\n            scrolling: false,\n            close: '',\n            top:0\n        });\n\n        $(window).scroll(function() {\n            var top = $(window).scrollTop();\n            $(\".cogbox\").css(\"top\", top + 10);\n\n        });\n\n        setInterval(function() {\n\n            var iframe = $('.cboxIframe')[0];\n\n            if (iframe) {\n                var doc = iframe.contentDocument || iframe.document;\n\n                var height = doc.body.clientHeight || doc.documentElement.scrollHeight;\n\n                $.colorbox.resize({ height: height });\n            }\n\n\n        }, 200)\n\n\n    })\n\n\n});\n"]}