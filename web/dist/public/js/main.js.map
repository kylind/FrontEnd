{"version":3,"sources":["public/js/main.js"],"names":["requirejs","config","baseUrl","paths","knockout","knockout.mapping","ReceivedOrders","ReckoningOrders","IncomeList","Addresses","ItemsModel","swiper","colorbox","tag","angular","ngResource","ngAnimate","settings.component","shim","exports","deps","require","OrdersModel","ko","$","Swiper","setViewModelStatus","activeIndex","viewModelStatus","ordersModel","getJSON","orders","status","setOrders","setTimeout","update","getObservableOrders","reckoningOrdersModel","observableOrders","updateAllData","incomeListModel","setIncomeList","rs","resolve","itemsModel","items","applyBindings","isArray","tags","incomeList","isTouch","document","documentElement","on","fn","_on","arguments","apply","bindingHandlers","tap","init","element","valueAccessor","allBindings","viewModel","bindingContext","handler","event","$submitting","target","$succeed","$confirm","$target","offset","hasClass","one","children","$parent","text","css","needRefreshRest","top","show","addClass","removeClass","fadeOut","activeElement","fadeIn","delay","needRefreshCurrent","updateCurrentData","spaceBetween","$data","paginationClickable","bulletName","index","autoHeight","pagination","simulateTouch","longSwipes","className","setSwiper","IncomeListModel","AddressesModel","purchasePromise","Promise","reject","oldTag","promise","catch","reason","reckoningPromise","Array","updateTag","itemName","newTag","allItems","length","item","forEach","indexOf","blur","push","post","onSlideChangeStart","res","all","then","keyCode","bootstrap","targetPage","height","scrolling","trigger","params","setItems","window","scrollTop","inline","width","close","onComplete","setInterval","resize","scroll"],"mappings":"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","file":"main.js","sourcesContent":["requirejs.config({\n\n    baseUrl: './components',\n\n    paths: {\n\n        'jquery': './jquery/dist/jquery.min',\n        'knockout': './knockout/dist/knockout',\n        'knockout.mapping': '../js/knockout.mapping.2.4.1.min',\n        'ReceivedOrders': '../js/received-orders',\n        'ReckoningOrders': '../js/reckoning-orders',\n        'IncomeList': '../js/income-list',\n        'Addresses': '../js/addresses',\n        'ItemsModel': '../js/purchase-items',\n        'swiper': './swiper/dist/js/swiper.jquery.min',\n        'colorbox': './jquery-colorbox/jquery.colorbox-min',\n        'tag': '../js/jquery.tag',\n        'angular': './angular/angular.min',\n        'ngResource': './angular-resource/angular-resource.min',\n        'ngAnimate': './angular-animate/angular-animate.min',\n        //'settings.module': '../js/settings/settings.module',\n        //'settings.component': '../js/settings/settings.component'\n        'settings.component': '../js/settings/settings.min'\n    },\n    shim: {\n        'swiper': ['jquery'],\n        'knockout.mapping': ['knockout'],\n        'colorbox': ['jquery'],\n        'tag': ['jquery'],\n\n        'angular': {\n            exports: 'angular'\n        },\n        'ngResource': {\n            deps: ['angular'],\n            exports: 'angular'\n        },\n        'ngAnimate': {\n            deps: ['angular'],\n            exports: 'angular'\n        },\n    }\n\n});\n\n\nrequire(['ReceivedOrders', 'knockout', 'jquery', 'swiper'], function(OrdersModel, ko, $, Swiper) {\n\n    var isTouch = ('ontouchstart' in document.documentElement) ? 'touchstart' : 'click';\n    var _on = $.fn.on;\n    $.fn.on = function() {\n        arguments[0] = (arguments[0] === 'click') ? isTouch : arguments[0];\n        return _on.apply(this, arguments);\n    }\n\n\n\n    var viewModelStatus = [false, false, false, false];\n\n    function setViewModelStatus(activeIndex) {\n\n        switch (activeIndex) {\n            case 0:\n                viewModelStatus[1] = true;\n                viewModelStatus[2] = true;\n                break;\n            case 1:\n                viewModelStatus[0] = true;\n                viewModelStatus[2] = true;\n                break;\n            case 2:\n                viewModelStatus[0] = true;\n                viewModelStatus[1] = true;\n                viewModelStatus[3] = true;\n                break;\n        }\n    }\n\n    ko.bindingHandlers.tap = {\n\n        init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {\n\n            var handler = valueAccessor();\n\n            $(element).on('click', function(event) {\n\n                var $target = $(event.target);\n                var $submitting = $('.prompt-submitting');\n                var $succeed = $('.prompt-succeed');\n                var $confirm = $('.confirm');\n\n                if ($target.hasClass('action-delete') && $target.hasClass('action-submit')) {\n                    var offset = $target.offset();\n\n                    $('.confirm-submit').one('click', function() {\n\n                        $confirm.fadeOut('slow');\n                        handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                            $submitting.children('span').text(\" 提交中...\");\n                            var offset = $target.offset();\n                            $('.prompt').css('top', offset.top).show();\n\n                        }, function(needRefreshRest) {\n\n                            $submitting.addClass('disappeared')\n                            $succeed.removeClass('disappeared')\n\n                            $('.prompt').delay(600).fadeOut('slow', function() {\n                                $submitting.removeClass('disappeared')\n                                $succeed.addClass('disappeared')\n                            });\n\n                            setViewModelStatus(swiper.activeIndex);\n\n                            if (needRefreshRest) {\n                                updateAllData();\n                            }\n\n                        });\n\n                    })\n\n                    $('.confirm-cancel').one('click', function() {\n\n                        $confirm.fadeOut('slow');\n\n                    })\n\n                    $('.confirm').css('top', offset.top).fadeIn('slow');\n\n\n                } else if ($target.hasClass('action-submit')) {\n\n                    var activeElement = $(document.activeElement);\n\n                    if (!activeElement.hasClass('action-submit')) {\n                        activeElement.blur();\n\n                    }\n\n                    setTimeout(function() {\n\n                        handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                            $submitting.children('span').text(\" 提交中...\");\n                            var offset = $target.offset();\n                            $('.prompt').css('top', offset.top).show();\n\n                        }, function(needRefreshRest, needRefreshCurrent) {\n\n                            setViewModelStatus(swiper.activeIndex);\n\n                            $submitting.addClass('disappeared')\n                            $succeed.removeClass('disappeared')\n\n\n                            $('.prompt').delay(1200).fadeOut('slow', function() {\n                                $submitting.removeClass('disappeared')\n                                $succeed.addClass('disappeared')\n\n                            });\n\n\n                            if (needRefreshCurrent) {\n                                updateCurrentData();\n                            }\n\n                            if (needRefreshRest) {\n                                updateAllData();\n                            }\n\n\n                        });\n\n\n\n                    }, 100);\n\n\n\n                } else if ($target.hasClass('action-load')) {\n\n                    handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                        $submitting.children('span').text(\" 加载中...\");\n                        var offset = $target.offset();\n                        $('.prompt').css('top', offset.top).show();\n\n                    }, function() {\n\n                        $('.prompt').delay(600).fadeOut('slow');\n                        swiper.update();\n\n                    });\n\n                } else {\n                    handler(bindingContext.$data, bindingContext.$parent, event);\n\n\n                }\n                return false;\n            });\n\n\n        },\n        update: function(element, valueAccessor, allBindings, viewModel, bindingContext) {\n\n        }\n    }\n\n\n\n    var swiper = new Swiper('.swiper-container', {\n        autoHeight: true,\n        spaceBetween: 30,\n        pagination: '.swiper-pagination',\n        paginationClickable: true,\n        simulateTouch: false,\n        shortSwipes: false,\n        longSwipes: false,\n        paginationBulletRender: function(index, className) {\n            var bulletName = '';\n            switch (index) {\n                case 0:\n\n                    bulletName = '接单';\n                    break;\n\n                case 1:\n                    bulletName = '采购';\n                    break;\n\n                case 2:\n                    bulletName = '算账';\n                    break;\n\n                case 3:\n                    bulletName = '收益';\n                    break;\n                    /* case 4:\n                         bulletName = 'Delivery';\n                         break;*/\n            }\n            return '<span class=\"' + className + '\">' + bulletName + '</span>';\n        }\n\n    });\n    var itemsModel, reckoningOrdersModel, incomeListModel, addressesModel;\n\n    var ordersModel = new OrdersModel(orders);\n\n    ko.applyBindings(ordersModel, $('#receivedOrders')[0]);\n\n    ordersModel.setSwiper(swiper);\n\n\n    function updateCurrentData() {\n\n        if (swiper.activeIndex == 0) {\n\n            $.getJSON('./receivedOrdersJson', function(orders, status) {\n                ordersModel.setOrders(orders, true);\n                setTimeout(function() {\n                    swiper.update();\n                }, 100);\n            });\n\n        }\n\n        if (swiper.activeIndex == 2) {\n\n            $.getJSON('./reckoningOrdersJson', function(orders, status) {\n\n                var observableOrders = reckoningOrdersModel.getObservableOrders(orders);\n                reckoningOrdersModel.orders(observableOrders);\n\n                setTimeout(function() {\n                    swiper.update();\n                }, 100);\n\n            })\n\n        }\n\n    }\n\n    function updateAllData() {\n\n        var activeIndex = swiper.activeIndex;\n\n\n        if (activeIndex == 1 || activeIndex == 2) {\n            $.getJSON('./receivedOrdersJson', function(orders, status) {\n                ordersModel.setOrders(orders, true);\n                setTimeout(function() {\n                    swiper.update();\n                }, 100);\n            });\n\n        }\n\n        if (activeIndex == 0 || activeIndex == 2) {\n\n            $.getJSON('./purchaseItemsJson', function(rs, status) {\n                itemsModel.setItems(rs.items, true, true);\n                setTimeout(function() {\n                    swiper.update();\n                }, 100);\n            });\n\n        }\n\n\n        if (activeIndex == 0 || activeIndex == 1) {\n\n            $.getJSON('./reckoningOrdersJson', function(orders, status) {\n\n                var observableOrders = reckoningOrdersModel.getObservableOrders(orders);\n                reckoningOrdersModel.orders(observableOrders);\n                setTimeout(function() {\n                    swiper.update();\n                }, 100);\n\n            })\n\n        }\n\n        if (activeIndex == 2) {\n\n            $.getJSON('./incomeListJson', function(incomeList, status) {\n                incomeListModel.setIncomeList(incomeList);\n            })\n            setTimeout(function() {\n                swiper.update();\n            }, 100);\n\n        }\n    }\n\n\n    require(['ItemsModel', 'ReckoningOrders', 'IncomeList', 'Addresses', 'knockout', 'jquery', 'tag'], function(ItemsModel, OrdersModel, IncomeListModel, AddressesModel, ko, $) {\n\n\n        var purchasePromise = new Promise(function(resolve, reject) {\n\n            $.getJSON('./purchaseItemsJson', function(rs, status) {\n\n                itemsModel = new ItemsModel(rs.items, swiper);\n\n\n                resolve(itemsModel);\n\n\n                ko.applyBindings(itemsModel, $('#purchaseItems')[0]);\n\n                var promise = new Promise(function(resolve, reject) {\n                    $.getJSON(`./user/${USER_ID}`, function(rs, status) {\n                        resolve(rs);\n                    });\n                });\n\n                promise.catch(function(reason) {\n\n                })\n\n                promise.then(function(rs) {\n\n                    var tags = Array.isArray(rs.tags) ? rs.tags : [];\n\n                    $('.hidden-tag').tag({\n                        tags: tags,\n                        updateTag: function(itemName, oldTag, newTag) {\n\n                            if (oldTag == newTag) return;\n\n                            if (Array.isArray(itemsModel.allItems) && itemsModel.allItems.length > 0) {\n                                var item = itemsModel.allItems.find(function(item) {\n                                    return item._id == itemName;\n\n                                });\n\n                                item.tag = newTag;\n\n                                if (item) {\n\n                                    var tags = [];\n\n\n                                    itemsModel.allItems.forEach(function(item) {\n\n                                        if (tags.indexOf(item.tag) < 0 && item.tag) {\n                                            tags.push(item.tag);\n                                        }\n\n                                    })\n\n                                    itemsModel.tags(tags);\n                                }\n\n                            }\n\n                            $.post('./itemtag', {\n                                    itemName: itemName,\n                                    oldTag: oldTag,\n                                    newTag: newTag\n\n                                }, function(res, status) {\n\n                                    //updateAllData();\n                                    setViewModelStatus(swiper.activeIndex);\n\n\n                                },\n                                'json'\n                            );\n\n                        }\n\n                    });\n\n                });\n\n            });\n\n        });\n\n        var reckoningPromise = new Promise(function(resolve, reject) {\n\n            $.getJSON('./reckoningOrdersJson', function(orders, status) {\n                reckoningOrdersModel = new OrdersModel(orders, swiper);\n                resolve(reckoningOrdersModel);\n                ko.applyBindings(reckoningOrdersModel, $('#reckoningOrders')[0]);\n\n\n            });\n\n        })\n\n        Promise.all([purchasePromise, reckoningPromise]).then(function(rs) {\n\n        })\n\n        $.getJSON('./incomeListJson', function(incomeList, status) {\n            incomeListModel = new IncomeListModel(incomeList, swiper);\n            ko.applyBindings(incomeListModel, $('#incomeList')[0]);\n\n\n        });\n\n        // $.getJSON('./addressesJson', function(addresses, status) {\n        //     addressesModel = new AddressesModel(addresses, swiper);\n        //     ko.applyBindings(addressesModel, $('#addresses')[0]);\n\n        // });\n\n\n\n        $(document).on('keydown', function(event) {\n            if (event.keyCode == 13 && (swiper.activeIndex == 0 || swiper.activeIndex == 2)) {\n                //var $target = $(document.activeElement).closest('.enterArea').find('.action-enter');\n                $(document.activeElement).blur();\n\n                var targetPage = swiper.activeIndex == 0 ? 'receivedOrders' : 'reckoningOrders'\n\n                var $target = $('#' + targetPage + ' .action-enter');\n                setTimeout(function() {\n                    $target.trigger('click')\n                }, 100);\n                return false;\n            }\n\n        });\n\n\n        swiper.params.onSlideChangeStart = function(swiper) {\n\n            var activeIndex = swiper.activeIndex;\n            switch (swiper.activeIndex) {\n                case 0:\n\n                    if (viewModelStatus[activeIndex]) {\n\n                        $.getJSON('./receivedOrdersJson', function(orders, status) {\n\n                            ordersModel.setOrders(orders, true);\n                            viewModelStatus[activeIndex] = false;\n\n                        });\n                    }\n\n                    break;\n\n                case 1:\n                    if (viewModelStatus[activeIndex]) {\n                        $.getJSON('./purchaseItemsJson', function(rs, status) {\n                            itemsModel.setItems(rs.items, true, true);\n                            viewModelStatus[activeIndex] = false;\n\n                        });\n                    }\n                    break;\n\n                case 2:\n                    if (viewModelStatus[activeIndex]) {\n                        $.getJSON('./reckoningOrdersJson', function(orders, status) {\n\n                            var observableOrders = reckoningOrdersModel.getObservableOrders(orders);\n                            reckoningOrdersModel.orders(observableOrders);\n                            viewModelStatus[activeIndex] = false;\n\n                        })\n                    }\n\n                    break;\n\n                case 3:\n                    if (viewModelStatus[activeIndex]) {\n                        $.getJSON('./incomeListJson', function(incomeList, status) {\n                            incomeListModel.setIncomeList(incomeList);\n                            viewModelStatus[activeIndex] = false;\n\n                        })\n                    }\n                    break;\n\n            }\n\n            setTimeout(function() {\n                $(window).scrollTop(0);\n            }, 100);\n\n        }\n\n    });\n\n\n    require(['jquery', 'angular', 'settings.component', 'colorbox'], function($, angular) {\n\n        angular.bootstrap($('#settings')[0], ['settings']);\n\n        $('.icon-cog').colorbox({\n            inline: true,\n            width: 335,\n            height: 200,\n            scrolling: false,\n            close: '',\n            top: 0,\n            onComplete: function() {\n                setInterval(function() {\n\n                    /*                    var iframe = $('.cboxIframe')[0];\n\n                                        if (iframe) {\n                                            var doc = iframe.contentDocument || iframe.document;\n\n                                            var height = Math.max(doc.body ? doc.body.clientHeight : 0, doc.documentElement.scrollHeight);\n\n                                            height = height < 200 ? 200 : height;\n\n                                            $.colorbox.resize({ height: height });\n                                        }*/\n\n                    $.colorbox.resize();\n\n\n                }, 200)\n            }\n        });\n\n        $(window).scroll(function() {\n            var top = $(window).scrollTop();\n            $(\".cogbox\").css(\"top\", top + 10);\n            $(\".swiper-pagination\").css('top', top);\n            $(\".searchbox\").css(\"top\", top);\n\n        });\n\n    })\n\n\n});\n"]}