{"version":3,"sources":["public/js/main.js"],"names":["requirejs","config","baseUrl","paths","knockout","knockout.mapping","ReceivedOrders","ReckoningOrders","IncomeList","Addresses","ItemsModel","swiper","colorbox","angular","ngResource","ngAnimate","settings.component","shim","exports","deps","require","OrdersModel","ko","$","Swiper","getJSON","orders","status","ordersModel","setOrders","update","observableOrders","activeIndex","reckoningOrdersModel","getObservableOrders","updateAllData","itemsModel","applyBindings","rs","setItems","items","markedItems","document","on","event","$target","incomeList","incomeListModel","setIncomeList","isTouch","documentElement","fn","_on","arguments","apply","bindingHandlers","tap","init","element","valueAccessor","allBindings","viewModel","bindingContext","handler","target","$submitting","$succeed","hasClass","offset","one","$confirm","fadeOut","$data","$parent","children","top","show","addClass","removeClass","delay","setTimeout","css","fadeIn","text","bulletName","autoHeight","spaceBetween","pagination","paginationClickable","simulateTouch","longSwipes","className","index","updateCurrentData","setSwiper","IncomeListModel","AddressesModel","keyCode","activeElement","blur","targetPage","trigger","params","onSlideChangeStart","window","scrollTop","bootstrap","inline","width","height","scrolling","close","onComplete","setInterval","resize","scroll"],"mappings":"YAAAA,WAAUC,QAAVD,QAAUC,eAENC,OAEAC,OAAO,2BAGHC,SAAY,2BADZC,mBAAU,mCACVC,eAAY,wBACZC,gBAAA,yBACAC,WAAA,oBACAC,UAAA,kBACAC,WAAc,uBACdC,OAAA,qCACAC,SAAA,wCACAC,QAAU,wBACVC,WAAY,0CACZC,UAAW,wCAGXC,qBAAA,6BAEAC,MArBSN,QAAA,UAuBbM,oBAAM,YACFL,UAAW,UAEXC,SAAaK,QAHX,WAMFJ,YAAgBK,MAAO,WAAYD,QAAS,WAD5CH,WAAaG,MAAS,WALpBA,QAAA,cAaVE,SAAS,iBAAkB,WAAY,SAAU,UAAW,SAASC,EAAaC,EAAIC,EAAGC,GA+MjF,QAAIb,KAEU,GAAVY,EAAEE,aAEDF,EAFDE,QAAA,uBAAA,SAAAC,EAAAC,GAIHC,EAAAC,UAAAH,GArCOf,EAAOmB,WA2CHC,GAAJpB,EAAAqB,aAGHT,EALDE,QAAA,wBAAA,SAAAC,EAAAC,GAhCI,GAAII,GAAmBE,EAAqBC,oBAAoBR,EAyCpEf,GAAyBe,OAAAK,GAvCrBpB,EAAOmB,WAQnB,QAASK,KA+CgBC,GAAjBd,EAAGe,aAzCHd,EAAEE,QAAQ,uBAAwB,SAASC,EAAQC,GA8CrDF,EAAQI,UAAAH,KAMA,GAARD,EAAQO,aAENV,EAAAA,QAAGe,sBAAH,SAAoCC,EAAAX,GAFxCS,EAAAG,SAAAD,EAAAE,MAAAF,EAAAG,eAtC0B,GAAtB9B,EAAOqB,aAEPT,EAAEE,QAAQ,wBAAyB,SAASC,EAAQC,GAkDtDe,GAAUC,GAAcV,EAAgBC,oBAAAR,EAClCkB,GAAAlB,OAAwBf,KAMR,GAAhBA,EAAAqB,aAEIa,EAAAA,QAAAA,mBAAgB,SAAhBC,EAAAnB,GACHoB,EAFDC,cAAAF,KAjRZ,GAAIG,GAAW,gBAAkBP,UAASQ,gBAAmB,aAAe,QAAxED,EAAAA,EAAAA,GAAWN,EACfpB,GAAA4B,GAAIC,GAAM7B,WAEN8B,MADJA,WAAU,GAAW,UAAXA,UAAW,GAAAJ,EAAAI,UAAA,GACjBA,EAAAC,MAAgBD,KAAAA,YAIpB/B,EAAGiC,gBAAgBC,KAEfC,KAAM,SAASC,EAASC,EAAeC,EAAaC,EAAWC,GAE3D,GAAIC,GAAUJ,GAEdpC,GAAEmC,GAASf,GAAG,QAAS,SAASC,GAE5B,GAAIC,GAAUtB,EAAEqB,EAAMoB,QAAlBnB,EAAYD,EAAAA,sBACZqB,EAAAA,EAAAA,mBACAC,EAAW3C,EAAE,WAGjB,IAAIsB,EAAQsB,SAAS,kBAAoBtB,EAAQsB,SAAS,iBAAkB,CAAxEtB,GAAAA,GAAQsB,EAASC,QAGjB7C,GAAE,mBAAmB8C,IAAI,QAAS,WAE9BC,EAASC,QAAQ,QAAjBD,EAAAA,EAAAE,MAAAV,EAAAW,QAAA7B,EAAA,WACAmB,EAAQD,SAAeU,QAAOV,KAAAA,gBAC1BG,IAAAA,GAAYS,EAASN,QACrB7C,GAAA,WAAasB,IAAAA,MAAQuB,EAArBO,KAAAC,QAGD,WAECX,EAAYY,SAAS,eACrBX,EAASY,YAAY,eAErBvD,EAAE,WAAWwD,MAAM,KAAKR,QAAQ,OAAQ,WACpCN,EAAYa,YAAY,eACxBZ,EAASW,SAAS,iBAGtB1C,QAQJmC,EAAAA,mBAAiBD,IAAA,QAAjB,WAAAC,EAASC,QAAQ,UASrBS,EAAAA,YAAWC,IAAA,MAAWb,EAAAO,KAAAO,OAAA,YAGdjB,GAAAA,SAAYS,iBAEZnD,WAAE,WAHNwC,EAAQD,EAAeU,MAAOV,EAAeW,QAAS7B,EAAO,WAOzDqB,EAAYY,SAAS,QAAAM,KAArB,gBACAjB,IAAAA,GAASY,EAAYV,QALrB7C,GAAE,WAAW0D,IAAI,MAAOb,EAAOO,KAAKC,QAShCX,WAGHA,EAJDY,SAAA,eAHAX,EAASY,YAAY,eAWpBvD,EAAA,WAAAwD,MAAA,MAAAR,QAAA,OAAA,WAPGN,EAAYa,YAAY,eAS5B3C,EAAAA,SAAAA,iBAJIU,EAAQsB,SAAS,gBAkBrBL,IAGF3B,OAaH,KAxGnBU,EAAAsB,SAAA,eAqHaJ,EAAWD,EAAAU,MAAqBV,EAAAW,QAAA7B,EAAA,WAAAqB,EAAAS,SAAA,QAAAS,KAAA,aAAA,IAAAf,GAAAvB,EAAAuB,QAG7B7C,GAAA,WAAA0D,IAH6B,MAAAb,EAAAO,KAAAC,QAK1B,WAEHrD,EAP6B,WAAAwD,MAAA,KAAAR,QAAA,UAjB7BR,EAAQD,EAAeU,MAAOV,EAAeW,QAAS7B,EAiC1D,QAAA,KAKIwC,OAAAA,SAAAA,EAAazB,EAAbC,EAAAC,EAAAC,KArBhB,IAqEA1B,GAASD,EAAgBY,EArErBpC,EAAS,GAAIa,GAAO,qBAUhB6D,YAAA,EAqBAC,aAAO,GACVC,WAAA,qBA5BDC,qBAAqB,EAJzBC,eAAA,EAmCIrD,aAAYH,EA5BZyD,YAAY,EA8BZ9D,uBAAkBP,SAAYK,EAAlCiE,GA5BQ,GAAIP,GAAa,EA8BtB/C,QAAHuD,GA5BY,IAAK,GAEDR,EAAa,IA+BpBS,MAEDlF,KAAOqB,GA7BCoD,EAAa,IA+BnB3D,MAEEd,KAAAA,GAFJyE,EAAA,IAKH,MAEGzE,KAAOqB,GA9BCoD,EAAa,KAsCpB,MAND,gBAAAO,EAAA,KAAAP,EAAA,aAgBJxD,EAAWI,GAAAA,GAAkBN,OAEzBH,GAAAA,cAAAK,EAAUL,EAAA,mBAAwB,IAEjCK,EAFDkE,UAAAnF,GAsFAS,SAAA,aAAA,kBAAA,aAAA,YAAA,WAAA,UAAA,SAAAV,EAAAW,EAAA0E,EAAAC,EAAA1E,EAAAC,GAhDJA,EAAEE,QAAQ,sBAAuB,SAASa,EAAIX,GAqD1CS,EAAA,GAAA1B,GAAA4B,EAAAE,MAAAF,EAAAG,YAAA9B,GAlDAW,EAAGe,cAAcD,EAAYb,EAAE,kBAAkB,MAwDjDA,EAAAE,QAAA,wBAAA,SAAAC,EAAAC,GACAM,EAAA,GAAAZ,GAAAK,EAAAf,GAlDAW,EAAGe,cAAcJ,EAAsBV,EAAE,oBAAoB,MAuD7DA,EAAAE,QAAA,mBAAA,SAAAqB,EAAAnB,GACAoB,EAAA,GAAAgD,GAAAjD,EAAAnC,GAlDAW,EAAGe,cAAcU,EAAiBxB,EAAE,eAAe,MA+DnDA,EAAAmB,UAAAC,GAAA,UAAA,SAAAC,GACA,GAAA,IAAAA,EAAAqD,UAAA,GAAAtF,EAAAqB,aAAA,GAAArB,EAAAqB,aAAA,CAEAT,EAAAmB,SAAAwD,eAAAC,MAEA,IAAAC,GAAA,GAAAzF,EAAAqB,YAAA,iBAAA,kBAEAa,EAAAtB,EAAA,IAAA6E,EAAA,iBAIApB,OAHAA,YAAA,WACAnC,EAAAwD,QAAA,UAlDO,MAoDI,KAYnBjF,EAASkF,OAADC,mBAAsB,SAAA5F,GAZtBqE,WAAW,WACPzD,EAAEiF,QAAQC,UAAU,GACpB9F,EAAOmB,UACT,QASVV,SAAS,SAAU,UAAW,qBAAsB,YAAa,SAASG,EAAGV,GAEzEA,EAAQ6F,UAAUnF,EAAE,aAAa,IAAK,aAEtCA,EAAE,aAAaX,UACX+F,QAAQ,EACRC,MAAO,IACPC,OAAQ,IACRC,WAAW,EACXC,MAAO,GACPpC,IAAK,EACLqC,WAAY,WACRC,YAAY,WAcR1F,EAAEX,SAASsG,UAGZ,QAIX3F,EAAEiF,QAAQW,OAAO,WACb,GAAIxC,GAAMpD,EAAEiF,QAAQC,WACpBlF,GAAE,WAAW0D,IAAI,MAAON,EAAM,IAC9BpD,EAAE,sBAAsB0D,IAAI,MAAON,GACnCpD,EAAE,cAAc0D,IAAI,MAAON","file":"main.js","sourcesContent":["requirejs.config({\n\n    baseUrl: './components',\n\n    paths: {\n\n        'jquery': './jquery/dist/jquery.min',\n        'knockout': './knockout/dist/knockout',\n        'knockout.mapping': '../js/knockout.mapping.2.4.1.min',\n        'ReceivedOrders': '../js/received-orders',\n        'ReckoningOrders': '../js/reckoning-orders',\n        'IncomeList': '../js/income-list',\n        'Addresses': '../js/addresses',\n        'ItemsModel': '../js/purchase-items',\n        'swiper': './swiper/dist/js/swiper.jquery.min',\n        'colorbox': './jquery-colorbox/jquery.colorbox-min',\n        'angular': './angular/angular.min',\n        'ngResource': './angular-resource/angular-resource.min',\n        'ngAnimate': './angular-animate/angular-animate.min',\n        //'settings.module': '../js/settings/settings.module',\n        //'settings.component': '../js/settings/settings.component'\n        'settings.component': '/js/settings/settings.min'\n    },\n    shim: {\n        'swiper': ['jquery'],\n        'knockout.mapping': ['knockout'],\n        'colorbox': ['jquery'],\n\n        'angular': { exports: 'angular' },\n        'ngResource': { deps: ['angular'], exports: 'angular' },\n        'ngAnimate': { deps: ['angular'], exports: 'angular' },\n    }\n\n});\n\n\nrequire(['ReceivedOrders', 'knockout', 'jquery', 'swiper'], function(OrdersModel, ko, $, Swiper) {\n\n    var isTouch = ('ontouchstart' in document.documentElement) ? 'touchstart' : 'click';\n    var _on = $.fn.on;\n    $.fn.on = function() {\n        arguments[0] = (arguments[0] === 'click') ? isTouch : arguments[0];\n        return _on.apply(this, arguments);\n    }\n\n    ko.bindingHandlers.tap = {\n\n        init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {\n\n            var handler = valueAccessor();\n\n            $(element).on('click', function(event) {\n\n                var $target = $(event.target);\n                var $submitting = $('.prompt-submitting');\n                var $succeed = $('.prompt-succeed');\n                var $confirm = $('.confirm');\n\n                if ($target.hasClass('action-delete') && $target.hasClass('action-submit')) {\n                    var offset = $target.offset();\n\n                    $('.confirm-submit').one('click', function() {\n\n                        $confirm.fadeOut('slow');\n                        handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                            $submitting.children('span').text(\"Submitting...\");\n                            var offset = $target.offset();\n                            $('.prompt').css('top', offset.top).show();\n\n                        }, function() {\n\n                            $submitting.addClass('disappeared')\n                            $succeed.removeClass('disappeared')\n\n                            $('.prompt').delay(600).fadeOut('slow', function() {\n                                $submitting.removeClass('disappeared')\n                                $succeed.addClass('disappeared')\n                            });\n\n                            updateAllData();\n\n                        });\n\n                    })\n\n                    $('.confirm-cancel').one('click', function() {\n\n                        $confirm.fadeOut('slow');\n\n                    })\n\n                    $('.confirm').css('top', offset.top).fadeIn('slow');\n\n\n                } else if ($target.hasClass('action-submit')) {\n\n                    setTimeout(function() {\n\n                        handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                            $submitting.children('span').text(\"Submitting...\");\n                            var offset = $target.offset();\n                            $('.prompt').css('top', offset.top).show();\n\n                        }, function() {\n\n                            $submitting.addClass('disappeared')\n                            $succeed.removeClass('disappeared')\n\n\n                            $('.prompt').delay(1200).fadeOut('slow', function() {\n                                $submitting.removeClass('disappeared')\n                                $succeed.addClass('disappeared')\n\n                            });\n\n                            if ($target.hasClass('action-mark')) {\n                                updateCurrentData();\n                            }\n\n                            updateAllData();\n\n\n                        });\n\n\n\n\n                    }, 100);\n\n\n\n                } else if ($target.hasClass('action-load')) {\n\n                    handler(bindingContext.$data, bindingContext.$parent, event, function() {\n                        $submitting.children('span').text(\"Loading...\");\n                        var offset = $target.offset();\n                        $('.prompt').css('top', offset.top).show();\n\n                    }, function() {\n\n                        $('.prompt').delay(600).fadeOut('slow');\n\n                    });\n\n                } else {\n                    handler(bindingContext.$data, bindingContext.$parent, event);\n\n\n                }\n                return false;\n            });\n\n\n        },\n        update: function(element, valueAccessor, allBindings, viewModel, bindingContext) {\n\n        }\n    }\n\n\n\n\n    var swiper = new Swiper('.swiper-container', {\n        autoHeight: true,\n        spaceBetween: 30,\n        pagination: '.swiper-pagination',\n        paginationClickable: true,\n        simulateTouch: false,\n        shortSwipes: false,\n        longSwipes: false,\n        paginationBulletRender: function(index, className) {\n            var bulletName = '';\n            switch (index) {\n                case 0:\n\n                    bulletName = '接单';\n                    break;\n\n                case 1:\n                    bulletName = '采购';\n                    break;\n\n                case 2:\n                    bulletName = '算账';\n                    break;\n\n                case 3:\n                    bulletName = '收益';\n                    break;\n                    /* case 4:\n                         bulletName = 'Delivery';\n                         break;*/\n            }\n            return '<span class=\"' + className + '\">' + bulletName + '</span>';\n        }\n\n    });\n    var itemsModel, reckoningOrdersModel, incomeListModel, addressesModel;\n\n    var ordersModel = new OrdersModel(orders);\n\n    ko.applyBindings(ordersModel, $('#receivedOrders')[0]);\n\n    ordersModel.setSwiper(swiper);\n\n\n    function updateCurrentData() {\n\n        if (swiper.activeIndex == 0) {\n\n            $.getJSON('./receivedOrdersJson', function(orders, status) {\n                ordersModel.setOrders(orders);\n                swiper.update();\n            });\n\n        }\n\n        if (swiper.activeIndex == 2) {\n\n            $.getJSON('./reckoningOrdersJson', function(orders, status) {\n\n                var observableOrders = reckoningOrdersModel.getObservableOrders(orders);\n                reckoningOrdersModel.orders(observableOrders);\n                swiper.update();\n\n            })\n\n        }\n\n    }\n\n    function updateAllData() {\n\n\n\n        if (swiper.activeIndex != 0) {\n\n            $.getJSON('./receivedOrdersJson', function(orders, status) {\n                ordersModel.setOrders(orders);\n            });\n\n        }\n\n        if (swiper.activeIndex != 1) {\n\n            $.getJSON('./purchaseItemsJson', function(rs, status) {\n                itemsModel.setItems(rs.items, rs.markedItems);\n            });\n\n        }\n\n        if (swiper.activeIndex != 2) {\n\n            $.getJSON('./reckoningOrdersJson', function(orders, status) {\n\n                var observableOrders = reckoningOrdersModel.getObservableOrders(orders);\n                reckoningOrdersModel.orders(observableOrders);\n\n            })\n\n        }\n\n        if (swiper.activeIndex != 3) {\n\n            $.getJSON('./incomeListJson', function(incomeList, status) {\n                incomeListModel.setIncomeList(incomeList);\n            })\n\n        }\n    }\n\n\n    require(['ItemsModel', 'ReckoningOrders', 'IncomeList', 'Addresses', 'knockout', 'jquery'], function(ItemsModel, OrdersModel, IncomeListModel, AddressesModel, ko, $) {\n\n\n        $.getJSON('./purchaseItemsJson', function(rs, status) {\n\n            itemsModel = new ItemsModel(rs.items, rs.markedItems, swiper);\n            ko.applyBindings(itemsModel, $('#purchaseItems')[0]);\n\n        });\n\n\n        $.getJSON('./reckoningOrdersJson', function(orders, status) {\n            reckoningOrdersModel = new OrdersModel(orders, swiper);\n            ko.applyBindings(reckoningOrdersModel, $('#reckoningOrders')[0]);\n\n        });\n\n        $.getJSON('./incomeListJson', function(incomeList, status) {\n            incomeListModel = new IncomeListModel(incomeList, swiper);\n            ko.applyBindings(incomeListModel, $('#incomeList')[0]);\n\n        });\n\n        // $.getJSON('./addressesJson', function(addresses, status) {\n        //     addressesModel = new AddressesModel(addresses, swiper);\n        //     ko.applyBindings(addressesModel, $('#addresses')[0]);\n\n        // });\n\n\n\n        $(document).on('keydown', function(event) {\n            if (event.keyCode == 13 && (swiper.activeIndex == 0 || swiper.activeIndex == 2)) {\n                //var $target = $(document.activeElement).closest('.enterArea').find('.action-enter');\n                $(document.activeElement).blur();\n\n                var targetPage = swiper.activeIndex == 0 ? 'receivedOrders' : 'reckoningOrders'\n\n                var $target = $('#' + targetPage + ' .action-enter');\n                setTimeout(function() {\n                    $target.trigger('click')\n                }, 100);\n                return false;\n\n            }\n\n        });\n\n\n        swiper.params.onSlideChangeStart = function(swiper) {\n\n            // switch (swiper.activeIndex) {\n            //     case 0:\n            //         $.getJSON('./receivedOrdersJson', function(orders, status) {\n\n            //             ordersModel.setOrders(orders);\n            //             swiper.update();\n\n            //         });\n            //         break;\n            //     case 1:\n            //         $.getJSON('./purchaseItemsJson', function(rs, status) {\n            //             itemsModel.setItems(rs.items, rs.markedItems);\n            //             swiper.update();\n\n            //         });\n            //         break;\n\n            //     case 2:\n            //         $.getJSON('./reckoningOrdersJson', function(orders, status) {\n\n            //             var observableOrders = reckoningOrdersModel.getObservableOrders(orders);\n            //             reckoningOrdersModel.orders(observableOrders);\n            //             swiper.update();\n\n            //         })\n            //         break;\n            //     case 3:\n            //         $.getJSON('./incomeListJson', function(incomeList, status) {\n            //             incomeListModel.setIncomeList(incomeList);\n            //             swiper.update();\n\n            //         })\n            //         break;\n            //     case 4:\n            //         $.getJSON('./addressesJson', function(addresses, status) {\n            //             addressesModel.setAddresses(addresses);\n            //             swiper.update();\n\n            //         })\n            //         break;\n            // }\n\n            setTimeout(function(){\n                $(window).scrollTop(0);\n                swiper.update();\n            },100);\n\n\n        }\n\n\n    });\n\n\n    require(['jquery', 'angular', 'settings.component', 'colorbox'], function($, angular) {\n\n        angular.bootstrap($('#settings')[0], ['settings']);\n\n        $('.icon-cog').colorbox({\n            inline: true,\n            width: 335,\n            height: 200,\n            scrolling: false,\n            close: '',\n            top: 0,\n            onComplete: function() {\n                setInterval(function() {\n\n/*                    var iframe = $('.cboxIframe')[0];\n\n                    if (iframe) {\n                        var doc = iframe.contentDocument || iframe.document;\n\n                        var height = Math.max(doc.body ? doc.body.clientHeight : 0, doc.documentElement.scrollHeight);\n\n                        height = height < 200 ? 200 : height;\n\n                        $.colorbox.resize({ height: height });\n                    }*/\n\n                    $.colorbox.resize();\n\n\n                }, 200)\n            }\n        });\n\n        $(window).scroll(function() {\n            var top = $(window).scrollTop();\n            $(\".cogbox\").css(\"top\", top + 10);\n            $(\".swiper-pagination\").css('top', top);\n            $(\".searchbox\").css(\"top\", top);\n\n        });\n\n    })\n\n\n});\n"]}