{"version":3,"sources":["public/js/purchase-items.js"],"names":["define","$","ko","mapping","Item","item","self","_id","observable","quantity","purchaseDetail","observableArray","subItems","hasItemDetail","subItem","length","displaySubItems","computed","markDone","markItemStatus","isDone","notDone","forEach","markSubItemStatus","isSubItemsOpen","MarkedItem","name","note","ItemsModel","items","markedItems","swiper","init","observableItems","Array","isArray","push","observableMarkedItems","itemview","setItems","getSubName","getSubItems","parent","event","itemData","toJS","arguments","succeed","getJSON","itemName","res","status","target","parents","next","slideDown","update","slideUp","isPurchased","post"],"mappings":"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","file":"purchase-items.js","sourcesContent":["define(['jquery', 'knockout', 'knockout.mapping'], function($, ko, mapping) {\n\n    ko.mapping = mapping;\n    var Item = function(item) {\n        var self = this;\n        self._id = ko.observable(item ? item._id : '');\n        self.quantity = ko.observable(item ? item.quantity : '');\n        self.purchaseDetail = ko.observableArray(item ? item.purchaseDetail : []);\n\n        self.subItems = ko.observableArray([]);\n\n        self.hasItemDetail = function(subItem) {\n\n            return self.subItems().length > 0 ? true : false;\n\n        };\n\n        self.displaySubItems = ko.computed(function() {\n\n            return self.subItems().length > 0;\n\n        });\n\n        self.markDone = function() {\n\n        }\n\n        self.markItemStatus = function() {\n\n            var purchaseDetail = self.purchaseDetail();\n\n            var isDone = 0,\n                notDone = 0;\n\n            purchaseDetail.forEach(function(item) {\n                if (item.isDone) {\n                    isDone = item.quantity;\n\n                } else {\n                    notDone = item.quantity;\n\n                }\n\n            })\n\n            if (notDone == self.quantity()) {\n                return '';\n            } else if (notDone == 0) {\n                return 'font-green';\n            } else {\n                return \"font-yellow\";\n            }\n\n\n\n        }\n\n        self.markSubItemStatus = function(item) {\n\n            if (item.isDone) {\n                return 'font-red';\n\n            } else {\n                return \"\";\n            }\n\n\n        }\n\n        self.isSubItemsOpen = false;\n\n    };\n\n\n    var MarkedItem = function(item) {\n\n        var self = this;\n        self.name = item ? item.name : '';\n        self.note = item ? item.note : '';\n        self.quantity = item ? item.quantity : '';\n\n    };\n\n    var ItemsModel = function(items, markedItems, swiper) {\n\n        function init(items,markedItems) {\n            var observableItems = [];\n\n            if (Array.isArray(items) && items.length > 0) {\n                items.forEach(function(item) {\n\n                    observableItems.push(new Item(item));\n\n                })\n            }\n\n            var observableMarkedItems = [];\n\n            if (Array.isArray(markedItems) && markedItems.length > 0) {\n                markedItems.forEach(function(item) {\n\n                    observableMarkedItems.push(new MarkedItem(item));\n\n                })\n            }\n\n            return [observableItems,observableMarkedItems] ;\n        }\n\n        var items = init(items, markedItems);\n        var observableItems  = items[0];\n        var observableMarkedItems  = items[1];\n\n        var self = this;\n\n        self.itemview=ko.observable('name')\n\n        self.items = ko.observableArray(observableItems);\n        self.markedItems = ko.observableArray(observableMarkedItems);\n\n\n\n        self.setItems = function(items,markedItems) {\n            var [items, markedItems]=init(items,markedItems)\n\n            self.items(items);\n            self.markedItems(markedItems);\n\n        }\n\n        self.getSubName = function(item) {\n\n            return 'item' + item.isDone;\n\n        };\n\n        self.getSubItems = function(item, parent, event) {\n\n\n            var itemData = ko.mapping.toJS(item);\n\n            if (!item.isSubItemsOpen) {\n                arguments[3]();\n                var succeed = arguments[4]\n                $.getJSON('/subitems', { itemName: itemData._id }, function(res, status) {\n\n                    if (status == 'success') {\n                        item.subItems(res);\n\n                    } else {\n                        item.subItems([]);\n                    }\n\n                    $(event.target).parents('.orderitem-cnt').next().slideDown('fast', function() {\n                        item.isSubItemsOpen = true;\n                        swiper.update();\n                        succeed();\n                    });\n\n                });\n\n            } else {\n\n                $(event.target).parents('.orderitem-cnt').next().slideUp('fast', function() {\n                    item.isSubItemsOpen = false;\n                    swiper.update();\n                });\n\n\n            }\n\n\n\n        };\n\n        self.markDone = function(item) {\n            arguments[3]();\n            var succeed = arguments[4];\n\n            var itemData = ko.mapping.toJS(item);\n\n            var isPurchased = true;\n\n\n            itemData.purchaseDetail.forEach(function(item) {\n\n                if (!item.isDone) {\n                    isPurchased = false;\n                }\n\n            });\n\n            $.post('/item', {\n                    itemName: itemData._id,\n                    isDone: !isPurchased\n                }, function(res, status) {\n\n                    item.purchaseDetail(res.purchaseDetail);\n                    succeed();\n                },\n                'json'\n            );\n\n        };\n\n    }\n\n    return ItemsModel;\n\n})\n"]}