{"version":3,"sources":["public/js/purchase-items.js"],"names":["define","$","ko","mapping","Item","item","self","this","_id","observable","quantity","observableArray","purchaseDetail","subItems","displaySubItems","computed","length","markDone","markItemStatus","isDone","notDone","forEach","markSubItemStatus","isSubItemsOpen","MarkedItem","observableItems","Array","items","name","note","push","ItemsModel","observableMarkedItems","swiper","isArray","markedItems","itemview","setItems","_init","init","_init2","_slicedToArray","itemData","arguments","getSubName","status","event","parents","toJS","target","next","slideUp","update","itemName","res","slideDown","succeed","isPurchased","post"],"mappings":"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","file":"purchase-items.js","sourcesContent":["define(['jquery', 'knockout', 'knockout.mapping'], function($, ko, mapping) {\n\n    ko.mapping = mapping;\n    var Item = function(item) {\n        var self = this;\n        self._id = ko.observable(item ? item._id : '');\n        self.quantity = ko.observable(item ? item.quantity : '');\n        self.purchaseDetail = ko.observableArray(item ? item.purchaseDetail : []);\n\n        self.subItems = ko.observableArray([]);\n\n        self.hasItemDetail = function(subItem) {\n\n            return self.subItems().length > 0 ? true : false;\n\n        };\n\n        self.displaySubItems = ko.computed(function() {\n\n            return self.subItems().length > 0;\n\n        });\n\n        self.markDone = function() {\n\n        }\n\n        self.markItemStatus = function() {\n\n            var purchaseDetail = self.purchaseDetail();\n\n            var isDone = 0,\n                notDone = 0;\n\n            purchaseDetail.forEach(function(item) {\n                if (item.isDone) {\n                    isDone = item.quantity;\n\n                } else {\n                    notDone = item.quantity;\n\n                }\n\n            })\n\n            if (notDone == self.quantity()) {\n                return '';\n            } else if (notDone == 0) {\n                return 'font-green';\n            } else {\n                return \"font-yellow\";\n            }\n\n\n\n        }\n\n        self.markSubItemStatus = function(item) {\n\n            if (item.isDone) {\n                return 'font-red';\n\n            } else {\n                return \"\";\n            }\n\n\n        }\n\n        self.isSubItemsOpen = false;\n\n    };\n\n\n    var MarkedItem = function(item) {\n\n        var self = this;\n        self.name = item ? item.name : '';\n        self.note = item ? item.note : '';\n        self.quantity = item ? item.quantity : '';\n\n    };\n\n    var ItemsModel = function(items, markedItems, swiper) {\n\n        function init(items,markedItems) {\n            var observableItems = [];\n\n            if (Array.isArray(items) && items.length > 0) {\n                items.forEach(function(item) {\n\n                    observableItems.push(new Item(item));\n\n                })\n            }\n\n            var observableMarkedItems = [];\n\n            if (Array.isArray(markedItems) && markedItems.length > 0) {\n                markedItems.forEach(function(item) {\n\n                    observableMarkedItems.push(new MarkedItem(item));\n\n                })\n            }\n\n            return [observableItems,observableMarkedItems] ;\n        }\n\n        var items = init(items, markedItems);\n        var observableItems  = items[0];\n        var observableMarkedItems  = items[1];\n\n        var self = this;\n\n        self.itemview=ko.observable('name')\n\n        self.items = ko.observableArray(observableItems);\n        self.markedItems = ko.observableArray(observableMarkedItems);\n\n\n\n        self.setItems = function(items,markedItems) {\n            var [items, markedItems]=init(items,markedItems)\n\n            self.items(items);\n            self.markedItems(markedItems);\n\n        }\n\n        self.getSubName = function(item) {\n\n            return 'item' + item.isDone;\n\n        };\n\n        self.getSubItems = function(item, parent, event) {\n\n\n            var itemData = ko.mapping.toJS(item);\n\n            if (!item.isSubItemsOpen) {\n                arguments[3]();\n                var succeed = arguments[4]\n                $.getJSON('./subitems', { itemName: itemData._id }, function(res, status) {\n\n                    if (status == 'success') {\n                        item.subItems(res);\n\n                    } else {\n                        item.subItems([]);\n                    }\n\n                    $(event.target).parents('.orderitem-cnt').next().slideDown('fast', function() {\n                        item.isSubItemsOpen = true;\n                        succeed();\n                    });\n\n                });\n\n            } else {\n\n                $(event.target).parents('.orderitem-cnt').next().slideUp('fast', function() {\n                    item.isSubItemsOpen = false;\n                    swiper.update();\n                });\n\n\n            }\n\n\n\n        };\n\n        self.markDone = function(item) {\n            arguments[3]();\n            var succeed = arguments[4];\n\n            var itemData = ko.mapping.toJS(item);\n\n            var isPurchased = true;\n\n\n            itemData.purchaseDetail.forEach(function(item) {\n\n                if (!item.isDone) {\n                    isPurchased = false;\n                }\n\n            });\n\n            $.post('./item', {\n                    itemName: itemData._id,\n                    isDone: !isPurchased\n                }, function(res, status) {\n\n                    item.purchaseDetail(res.purchaseDetail);\n                    succeed();\n                },\n                'json'\n            );\n\n        };\n\n    }\n\n    return ItemsModel;\n\n})\n"]}