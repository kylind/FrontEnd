"use strict";var _slicedToArray=function(){function t(t,e){var n=[],a=!0,i=!1,r=void 0;try{for(var s,u=t[Symbol.iterator]();!(a=(s=u.next()).done)&&(n.push(s.value),!e||n.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{!a&&u.return&&u.return()}finally{if(i)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define(["jquery","knockout","knockout.mapping"],function(t,e,n){e.mapping=n;var a=function(t){var n=this;n._id=t._id,n.client=t.client,n.name=t.name,n.note=t.note,n.quantity=t.quantity,n.isDone=e.observable(t.isDone)},i=function(n,i){function r(t){var n=t.findIndex(function(t){return t._id==s._id&&t.tag==s.tag()});n>-1&&(t[n]=e.mapping.toJS(s))}var s=this;s._id=n?n._id:"",s.quantity=n?n.quantity:"",s.tag=e.observable(n&&n.tag?n.tag:""),s.purchaseDetail=e.observableArray(n?n.purchaseDetail:[]),s.subItems=e.observableArray([]),s.updateSubItems=function(t){var e=[];Array.isArray(t)&&t.length>0&&t.forEach(function(t){e.push(new a(t))}),s.subItems(e)},s.hasItemDetail=function(t){return s.subItems().length>0},s.restCount=e.pureComputed(function(){var t=s.purchaseDetail(),e=0,n=0;return t.forEach(function(t){t.isDone?e=t.quantity:n=t.quantity}),e<s.quantity&&0!=e?s.quantity-e:""}),s.displaySubItems=e.pureComputed(function(){return s.subItems().length>0}),s.markDone=function(n,a,i){arguments[3]();var u=arguments[4],o=e.mapping.toJS(n),c=!0;o.purchaseDetail.forEach(function(t){t.isDone||(c=!1)}),t.post("/item",{itemTag:o.tag,itemName:o._id,isDone:!c},function(t,e){n.purchaseDetail(t.purchaseDetail),r(a.allItems);s.displaySubItems&&s.subItems().forEach(function(t){t.isDone(!c)}),u(!0)},"json")},s.markItemStatus=function(){var t=s.purchaseDetail(),e=0,n=0;return t.forEach(function(t){t.isDone?e=t.quantity:n=t.quantity}),n==s.quantity?"":e==s.quantity?"font-green":"font-yellow"},s.markSubItemDone=function(n,a,i){arguments[3]();var u=arguments[4],o=arguments[5],c=e.mapping.toJS(n);c.isDone=!c.isDone,c.tag=a.tag(),t.post("/subitem",c,function(t,e){n.isDone(!n.isDone()),s.purchaseDetail(t.purchaseDetail),r(o.allItems),s.subItems().forEach(function(t){t.client==n.client&&t.isDone(n.isDone())}),u(!0)},"json")},s.getSubName=function(t){return"item"+t.isDone},s.getSubItems=function(n,a,r){var u=e.mapping.toJS(n);if(n.isSubItemsOpen)t(r.target).parents(".orderitem-cnt").next().slideUp("fast",function(){n.isSubItemsOpen=!1,i.update()});else{arguments[3]();var o=arguments[4];t.getJSON("/subitems",{itemName:u._id,itemTag:u.tag},function(e,a){"success"==a?s.updateSubItems(e):n.subItems([]),t(r.target).parents(".orderitem-cnt").next().slideDown("fast",function(){n.isSubItemsOpen=!0,o()})})}},s.isSubItemsOpen=!1},r=function(n,a){function r(t){var e="function"==typeof t.purchaseDetail?t.purchaseDetail():t.purchaseDetail,n=0,a=0;return e.forEach(function(t){t.isDone?n=t.quantity:a=t.quantity}),a==t.quantity?-1:n==t.quantity?1:0}function s(t,e){if(t.tag){if(e.tag){if(t.tag<e.tag)return-1;if(t.tag>e.tag)return 1;var n=r(t),a=r(e);return n<a?-1:n>a?1:0}return 1}return-1}function u(t,e){var n=r(t),a=r(e);return n<a?-1:n>a?1:t.tag?e.tag?t.tag<e.tag?-1:t.tag>e.tag?1:0:1:-1}function o(e,n,r){var o=[],c=[];if(Array.isArray(e)&&e.length>0){"status"==r?e.sort(u):e.sort(s);var n=!1;t(".link-tag.all").hasClass("isActive")&&(n=!0),e.forEach(function(t){o.push(new i(t,a)),n&&c.indexOf(t.tag)<0&&t.tag&&c.push(t.tag)})}return[o,c]}var c=this;c.allItems=[],c.tags=e.observableArray(),c.items=e.observableArray(),c.setItems=function(n,a,i){var r=!1;a&&(t(".link-tag.all").addClass("isActive"),r=!0);var s=o(n,r),u=_slicedToArray(s,2),n=u[0],l=u[1];c.items(n),a&&(c.tags(l),c.allItems=c.items().map(function(t){return e.mapping.toJS(t)})),i||setTimeout(function(){t(".hidden-tag").tag()},10)},c.setItems(n,!0,!0),c.refreshItems=function(n){var a=c.items().map(function(t){return e.mapping.toJS(t)}),i=t(".link-tag.isActive");i.hasClass("all")||(a=a.filter(function(t){return t.tag==i.text()}));var r=o(a,!1,n),s=_slicedToArray(r,2),u=s[0];s[1];c.items(u),setTimeout(function(){t(".hidden-tag").tag()},10)},c.filterItems=function(e,n,i){var r=t(i.target),s=t(".link-tag.isActive");if(s.removeClass("isActive"),r.addClass("isActive"),r.hasClass("all"))c.setItems(c.allItems,!0,!1);else{var u=c.allItems.filter(function(t){return t.tag==e});c.setItems(u)}a.update()}};return r});
//# sourceMappingURL=purchase-items.js.map
