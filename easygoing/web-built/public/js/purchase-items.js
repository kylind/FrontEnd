"use strict";var _slicedToArray=function(){function t(t,e){var n=[],i=!0,a=!1,r=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){a=!0,r=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define(["jquery","knockout","knockout.mapping"],function(t,e,n){e.mapping=n;var i=function(t){var n=this;n._id=t._id,n.client=t.client,n.name=t.name,n.note=t.note,n.quantity=t.quantity,n.isDone=e.observable(t.isDone)},a=function(n,a){function r(t){var n=t.findIndex(function(t){return t._id==s._id&&t.tag==s.tag()});n>-1&&(t[n]=e.mapping.toJS(s))}var s=this;s._id=n?n._id:"",s.quantity=n?n.quantity:"",s.tag=e.observable(n&&n.tag?n.tag:""),s.purchaseDetail=e.observableArray(n?n.purchaseDetail:[]),s.subItems=e.observableArray([]),s.updateSubItems=function(t){var e=[];Array.isArray(t)&&t.length>0&&t.forEach(function(t){e.push(new i(t))}),s.subItems(e)},s.hasItemDetail=function(t){return s.subItems().length>0},s.restCount=e.pureComputed(function(){var t=s.purchaseDetail(),e=0,n=0;return t.forEach(function(t){t.isDone?e=t.quantity:n=t.quantity}),e<s.quantity&&0!=e?s.quantity-e:""}),s.displaySubItems=e.pureComputed(function(){return s.subItems().length>0}),s.markDone=function(n,i,a){arguments[3]();var u=arguments[4],o=e.mapping.toJS(n),c=!0;o.purchaseDetail.forEach(function(t){t.isDone||(c=!1)}),t.post("./item",{itemTag:o.tag,itemName:o._id,isDone:!c},function(t,e){n.purchaseDetail(t.purchaseDetail),r(i.allItems);s.displaySubItems&&s.subItems().forEach(function(t){t.isDone(!c)}),u()},"json")},s.markItemStatus=function(){var t=s.purchaseDetail(),e=0,n=0;return t.forEach(function(t){t.isDone?e=t.quantity:n=t.quantity}),n==s.quantity?"":e==s.quantity?"font-green":"font-yellow"},s.markSubItemDone=function(n,i,a){arguments[3]();var u=arguments[4],o=arguments[5],c=e.mapping.toJS(n);c.isDone=!c.isDone,c.tag=i.tag(),t.post("./subitem",c,function(t,e){n.isDone(!n.isDone()),s.purchaseDetail(t.purchaseDetail),r(o.allItems),s.subItems().forEach(function(t){t.client==n.client&&t.isDone(n.isDone())}),u()},"json")},s.getSubName=function(t){return"item"+t.isDone},s.getSubItems=function(n,i,r){var u=e.mapping.toJS(n);if(n.isSubItemsOpen)t(r.target).parents(".orderitem-cnt").next().slideUp("fast",function(){n.isSubItemsOpen=!1,a.update()});else{arguments[3]();var o=arguments[4];t.getJSON("./subitems",{itemName:u._id,itemTag:u.tag},function(e,i){"success"==i?s.updateSubItems(e):n.subItems([]),t(r.target).parents(".orderitem-cnt").next().slideDown("fast",function(){n.isSubItemsOpen=!0,o()})})}},s.isSubItemsOpen=!1};return function(n,i){function r(t){var e="function"==typeof t.purchaseDetail?t.purchaseDetail():t.purchaseDetail,n=0,i=0;return e.forEach(function(t){t.isDone?n=t.quantity:i=t.quantity}),i==t.quantity?-1:n==t.quantity?1:0}function s(t,e){if(t.tag<e.tag)return-1;if(t.tag>e.tag)return 1;var n=r(t),i=r(e);if(n<i)return-1;if(n>i)return 1;var a=t._id.substr(0,1),s=e._id.substr(0,1);return a<s?-1:a>s?1:0}function u(t,e){var n=r(t),i=r(e);if(n<i)return-1;if(n>i)return 1;if(t.tag<e.tag)return-1;if(t.tag>e.tag)return 1;var a=t._id.substr(0,1),s=e._id.substr(0,1);return a<s?-1:a>s?1:0}function o(t,e,n){var r=[],o=[];return Array.isArray(t)&&t.length>0&&("status"==n?t.sort(u):t.sort(s),t.forEach(function(t){r.push(new a(t,i)),e&&o.indexOf(t.tag)<0&&t.tag&&o.push(t.tag)})),[r,o]}var c=this;c.allItems=[],c.tags=e.observableArray(),c.items=e.observableArray(),c.setItems=function(n,a,r){var s=!1;a&&(t(".link-tag.all").addClass("isActive"),s=!0);var u=o(n,s),f=_slicedToArray(u,2),n=f[0],l=f[1];c.items(n),a&&(c.tags(l),c.allItems=c.items().map(function(t){return e.mapping.toJS(t)})),r&&setTimeout(function(){t(".hidden-tag").tag()},10),setTimeout(function(){i.update()},100)},c.setItems(n,!0,!1),c.refreshItems=function(n){var i=c.items().map(function(t){return e.mapping.toJS(t)}),a=t(".link-tag.isActive");a.hasClass("all")||(i=i.filter(function(t){return t.tag==a.text()}));var r=o(i,!1,n),s=_slicedToArray(r,2),u=s[0];s[1];c.items(u),setTimeout(function(){t(".hidden-tag").tag()},10)},c.filterItems=function(e,n,a){var r=t(a.target);if(t(".link-tag.isActive").removeClass("isActive"),r.addClass("isActive"),r.hasClass("all"))c.setItems(c.allItems,!0,!0);else{var s=c.allItems.filter(function(t){return t.tag==e});c.setItems(s,!1,!0)}i.update(),t(document).click()}}});
//# sourceMappingURL=purchase-items.js.map
