"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("ReceivedOrders",["common"],function(e){var t=e.$,n=e.ko;n.mapping=e.mapping;var r=function(e){var t=this;t.name=n.observable(e&&e.name?e.name:""),t.quantity=n.observable(e&&e.quantity?e.quantity:"1"),t.note=n.observable(e&&e.note?e.note:""),t.buyPrice=e&&!isNaN(e.buyPrice)?e.buyPrice:"",t.sellPrice=e&&!isNaN(e.sellPrice)?e.sellPrice:"",t.profit=e&&e.profit?e.profit:"",t.isDone=!(!e||void 0===e.isDone)&&e.isDone,t.tag=e&&e.tag?e.tag:"",t.isChanged=!1,t.name.subscribe(function(e){t.isChanged=!0}),t.quantity.subscribe(function(e){t.isChanged=!0}),t.note.subscribe(function(e){t.isChanged=!0})},i=function(e){var i=this;i._id=n.observable(e&&e._id?e._id:""),i.client=n.observable(e&&e.client?e.client:""),i.packingStatus=n.observable(e&&e.packingStatus?e.packingStatus:"1ISREADY"),i.rate=e&&e.rate?e.rate:null,i.postage=e&&e.postage?e.postage:0,i.buyPrice=e&&e.buyPrice?e.buyPrice:"",i.sellPrice=e&&e.sellPrice?e.sellPrice:"",i.profit=e&&e.profit?e.profit:"",i.status=e&&e.status?e.status:"1RECEIVED",i.createDate=e&&e.createDate?e.createDate:"";var s=[];if(e&&t.isArray(e.items)&&e.items.length>0)e.items.forEach(function(e){s.push(new r(e))});else for(var o=0;o<3;o++)s.push(new r);i.items=n.observableArray(s),i.isChanged=!1,i.client.subscribe(function(e){i.isChanged=!0}),i.items.subscribe(function(e){i.isChanged=!0}),i.orderPackingStatus=n.pureComputed(function(){return"3PACKED"==i.packingStatus()?"font-green":"2NOTREADY"==i.packingStatus()?"font-yellow":"font-black"}),i.orderReadyStatus=n.pureComputed(function(){return"2NOTREADY"==i.packingStatus()?"icon-thumbsdown font-yellow":"icon-thumbsup font-black"})};return function(e,s){function o(e){var t=[];if(Array.isArray(e)&&e.length>0)e.forEach(function(e){t.push(new i(e))});else for(var n=0;n<30;n++)t.push(new i);return t}function a(e){e.sort(function(e,t){var n=e.packingStatus(),r=t.packingStatus();return n==r?e.createDate<=t.createDate?1:-1:n<r?-1:1})}function c(){setTimeout(function(){u.update()},100)}var u=s,l=this;l.setSwiper=function(e){u=e,c()};var d=o(e);l.orders=n.observableArray(d),l.setOrders=function(e,t){l.orders(o(e)),c()},l.addItem=function(e){e.items.unshift({name:"",quantity:1,note:"",buyPrice:"",sellPrice:"",isDone:!1}),c()},l.removeItem=function(e,t){t.items.remove(e),c()},l.submitOrder=function(e){arguments[3]();var r=arguments[4];console.log("post request....");var i=n.mapping.toJS(e);return t.post("./order",i,function(t,i){console.log("get post result"),n.mapping.fromJS(t,{},e),r()},"json"),!1},l.submitOrders=function(){arguments[3]();var e=arguments[4],i=l.orders(),s=t.parseJSON(n.toJSON(i));if(Array.isArray(s)&&s.length>0){var o=[],a=s.filter(function(e,t){var n=!1;if(""!=e.client)if(e.isChanged)n=!0;else for(var r=0;r<e.items.length;r++)if(e.items[r].isChanged){n=!0;break}return n&&o.push(t),n});a.length>0?t.post("./orders",{orders:a},function(s,a){s.forEach(function(e,s){var a=o[s];t.isArray(e.items)&&0==e.items.length&&(e.items=[{},{},{}]),n.mapping.fromJS(e,{items:{create:function(e){return new r(e.data)}}},i[a]),i[a].isChanged=!1}),e()},"json"):e()}return!1},l.markPackingStatus=function(e){arguments[3]();var n=arguments[4],r=(arguments[1],e._id()),i=e.packingStatus(),s=t(arguments[2].target),o="";if(s.hasClass("icon-leaf")?"1ISREADY"==i?o="3PACKED":"3PACKED"==i&&(o="1ISREADY"):o="1ISREADY"==i||"3PACKED"==i?"2NOTREADY":"1ISREADY",""==o)return void n();t.ajax("./packingStatus/"+r,{success:function(r,i){if(e.packingStatus(o),""==t("#search-receivedOrders").val()){var s=l.orders();a(s),l.orders(s)}n()},data:{packingStatus:o},dataType:"json",type:"PUT"})},l.addOrder=function(){var e=new i;l.orders.unshift(e),c(),t(window).scrollTop(0)},l.removeOrder=function(e){arguments[3]();var n=arguments[4],r=e._id();if(l.orders.remove(e),""==r)return void n();t.ajax("./order/"+r,{success:function(e,t){n()},dataType:"json",type:"DELETE"}),c()};var e=null;l.searchOrders=function(n,r){var i=t(r.target).val();if(null==e&&(e=l.orders()),""==i){a(e);var s=e}else var s=e.filter(function(e){return e.client().indexOf(i)>=0});l.orders(s),c()},l.afterRender=function(){c(),t(".mask").removeClass("isShow")},l.afterOrderRender=function(){t("#receivedOrdersBody").children().length===l.orders().length&&c()}}}),define("ItemsModel",["common"],function(e){var t=e.$,n=e.ko;n.mapping=e.mapping;var r=function(e){var t=this;t._id=e._id,t.client=e.client,t.name=e.name,t.note=e.note,t.quantity=e.quantity,t.isDone=n.observable(e.isDone)},i=function(e,i){function s(e){var t=e.findIndex(function(e){return e._id==o._id&&e.tag==o.tag()});t>-1&&(e[t]=n.mapping.toJS(o))}var o=this;o._id=e&&e._id?e._id:"",o.quantity=e?e.quantity:"",o.tag=n.observable(e&&e.tag?e.tag:""),o.purchaseDetail=n.observableArray(e?e.purchaseDetail:[]),o.subItems=n.observableArray([]),o.updateSubItems=function(e){var t=[];Array.isArray(e)&&e.length>0&&e.forEach(function(e){t.push(new r(e))}),o.subItems(t)},o.hasItemDetail=function(e){return o.subItems().length>0},o.restCount=n.pureComputed(function(){var e=o.purchaseDetail(),t=0,n=0;return e.forEach(function(e){e.isDone?t=e.quantity:n=e.quantity}),t<o.quantity&&0!=t?o.quantity-t:""}),o.displaySubItems=n.pureComputed(function(){return o.subItems().length>0}),o.markDone=function(e,r,i){arguments[3]();var a=arguments[4],c=n.mapping.toJS(e),u=!0;c.purchaseDetail.forEach(function(e){e.isDone||(u=!1)}),t.post("./item",{itemTag:c.tag,itemName:c._id,isDone:!u},function(t,n){e.purchaseDetail(t.purchaseDetail),s(r.allItems);o.displaySubItems&&o.subItems().forEach(function(e){e.isDone(!u)}),a()},"json")},o.markItemStatus=function(){var e=o.purchaseDetail(),t=0,n=0;return e.forEach(function(e){e.isDone?t=e.quantity:n=e.quantity}),n==o.quantity?"":t==o.quantity?"font-green":"font-yellow"},o.markSubItemDone=function(e,r,i){arguments[3]();var a=arguments[4],c=arguments[5],u=n.mapping.toJS(e);u.isDone=!u.isDone,u.tag=r.tag(),t.post("./subitem",u,function(t,n){e.isDone(!e.isDone()),o.purchaseDetail(t.purchaseDetail),s(c.allItems),o.subItems().forEach(function(t){t.client==e.client&&t.isDone(e.isDone())}),a()},"json")},o.getSubName=function(e){return"item"+e.isDone},o.getSubItems=function(e,r,s){var a=n.mapping.toJS(e);if(e.isSubItemsOpen())t(s.target).parents(".orderitem-cnt").next().slideUp("fast",function(){e.isSubItemsOpen(!1),i.update()});else{arguments[3]();var c=arguments[4];t.getJSON("./subitems",{itemName:a._id,itemTag:a.tag},function(n,r){"success"==r?o.updateSubItems(n):e.subItems([]),t(s.target).parents(".orderitem-cnt").next().slideDown("fast",function(){e.isSubItemsOpen(!0),c()})})}},o.getExpandCollapse=function(){return o.isSubItemsOpen()?"icon-collapse":"icon-expand"},o.isSubItemsOpen=n.observable(!1)};return function(e,r){function s(e){var t="function"==typeof e.purchaseDetail?e.purchaseDetail():e.purchaseDetail,n=0,r=0;return t.forEach(function(e){e.isDone?n=e.quantity:r=e.quantity}),r==e.quantity?-1:n==e.quantity?1:0}function o(e,t){if(e.tag<t.tag)return-1;if(e.tag>t.tag)return 1;var n=s(e),r=s(t);if(n<r)return-1;if(n>r)return 1;var i=e._id.substr(0,1),o=t._id.substr(0,1);return i<o?-1:i>o?1:0}function a(e,t){var n=s(e),r=s(t);if(n<r)return-1;if(n>r)return 1;if(e.tag<t.tag)return-1;if(e.tag>t.tag)return 1;var i=e._id.substr(0,1),o=t._id.substr(0,1);return i<o?-1:i>o?1:0}function c(e,t,n){var s=[],c=[];return Array.isArray(e)&&e.length>0&&("status"==n?e.sort(a):e.sort(o),e.forEach(function(e){s.push(new i(e,r)),t&&c.indexOf(e.tag)<0&&e.tag&&c.push(e.tag)})),[s,c]}var u=this;u.allItems=[],u.tags=n.observableArray(),u.items=n.observableArray(),u.setItems=function(e,i,s){var o=!1;i&&(t(".link-tag.all").addClass("isActive"),o=!0);var a=c(e,o),l=_slicedToArray(a,2),e=l[0],d=l[1];u.items(e),i&&(u.tags(d),u.allItems=u.items().map(function(e){return n.mapping.toJS(e)})),s&&setTimeout(function(){t(".hidden-tag").tag()},10),setTimeout(function(){r.update()},100)},u.setItems(e,!0,!1),u.refreshItems=function(e){var r=u.items().map(function(e){return n.mapping.toJS(e)}),i=t(".link-tag.isActive");i.hasClass("all")||(r=r.filter(function(e){return e.tag==i.text()}));var s=c(r,!1,e),o=_slicedToArray(s,2),a=o[0];o[1];u.items(a),setTimeout(function(){t(".hidden-tag").tag()},10)},u.filterItems=function(e,n,i){var s=t(i.target);if(t(".link-tag.isActive").removeClass("isActive"),s.addClass("isActive"),s.hasClass("all"))u.setItems(u.allItems,!0,!0);else{var o=u.allItems.filter(function(t){return t.tag==e});u.setItems(o,!1,!0)}r.update(),t(document).click()},u.afterRender=function(){r.update()}}}),define("ReckoningOrders",["common"],function(e){function t(){var e=Date.now(),t=(new Date).getDay(),n=e-24*(t+7)*60*60*1e3;return new Date(new Date(n).setHours(0,0,0,0))}var n=e.$,r=e.ko;r.mapping=e.mapping;var i=function(e){function t(e){var t=e;return"string"==typeof t&&t.startsWith("?")&&(t=t.slice(1),n.isChanged=!0),t}var n=this;n.name=r.observable(e&&e.name?e.name:""),n.quantity=r.observable(e&&e.quantity?e.quantity:"1"),n.buyPrice=r.observable(e&&e.buyPrice?t(e.buyPrice):""),n.sellPrice=r.observable(e&&e.sellPrice?t(e.sellPrice):""),n.profit=e&&e.profit?e.profit:"",n.note=e&&e.note?e.note:"",n.isDone=!(!e||!e.isDone)&&e.isDone,n.tag=e&&e.tag?e.tag:"",n.historicTrades=r.observableArray([]),n.isDoubtSellPrice=e.isDoubtSellPrice||!1,n.isDoubtBuyPrice=e.isDoubtBuyPrice||!1,n.isHistoricTradesOpen=!1,n.isChanged=!1,n.name.subscribe(function(e){n.isChanged=!0}),n.quantity.subscribe(function(e){n.isChanged=!0}),n.buyPrice.subscribe(function(e){n.isChanged=!0}),n.sellPrice.subscribe(function(e){n.isChanged=!0})},s=function(e,t){var s=this;s._id=r.observable(e?e._id:""),s.client=r.observable(e?e.client:""),s.postage=r.observable(e&&e.postage?e.postage:0);var o=[];if(e&&n.isArray(e.items)&&e.items.length>0)e.items.forEach(function(e){o.push(new i(e))});else for(var a=0;a<3;a++)o.push(new i);s.isChanged=e.isChanged||!1,s.items=r.observableArray(o),s.items.subscribe(function(e){s.isChanged=!0}),s.client.subscribe(function(e){s.isChanged=!0}),s.postage.subscribe(function(e){s.isChanged=!0}),s.createDate=r.observable(e?e.createDate:""),s.displayDate=r.observable(e?e.displayDate:""),s.rate=e?e.rate:"",s.buyPrice=r.observable(e&&e.buyPrice?e.buyPrice:""),s.sellPrice=r.observable(e&&e.sellPrice?e.sellPrice:""),s.profit=r.observable(e&&e.profit?e.profit:""),s.isComplete=r.observable(!(!e||!e.isComplete)&&e.isComplete),s.formatPrice=function(e){if(!e)return"?";var t=e();return t?(+t).toFixed(1):"?"},s.total=r.pureComputed(function(){var e=parseFloat(this.sellPrice()),t=parseFloat(this.postage());return isNaN(e)||isNaN(t)?"?":(e+t).toFixed(1)},s);s.status=r.observable(e?e.status:"1RECEIVED"),s.packingStatus=e?e.packingStatus:"1ISREADY",s.orderStatus=r.pureComputed(function(){return"3DONE"==s.status()?"font-green":"2SENT"==s.status()?"font-yellow":"3PACKED"!=s.packingStatus?"font-grey":void 0}),s.getHistoricTrades=function(e,i,s){var o=r.mapping.toJS(e),a=n(s.target).closest(".itembox--reckoning").find(".historicbox");if(e.isHistoricTradesOpen)a.slideUp("fast",function(){e.isHistoricTradesOpen=!1,t.update()});else{var c=arguments[4];if(""==o.name)return;arguments[3](),n.getJSON("./historictrades",{itemName:o.name},function(t,n){"success"==n?e.historicTrades(t):e.historicTrades([]),a.slideDown("fast",function(){e.isHistoricTradesOpen=!0,c()})})}},s.hasHistoricTrades=function(e){return e.historicTrades().length>0},s.addItem=function(){s.items.unshift(new i),t.update()},s.removeItem=function(e){s.items.remove(e),t.update()},s.addClient=function(e){var n;s.clients.unshift((n={_id:"",client:s.client(),recipient:""},_defineProperty(n,"client",""),_defineProperty(n,"phone",""),n)),t.update()},s.getClients=function(e){arguments[3]();var t=arguments[4],r=e.client();""!=r&&n.getJSON("./clientsByClient",{client:r},function(n,r){"success"==r?e.clients(n):e.clients([]),t()})};var c=[];s.removeClient=function(e){""!=e._id&&c.push(e._id),s.clients.remove(e),t.update()},s.submitClients=function(e){arguments[3]();var t=arguments[4],i=r.mapping.toJS(e.clients);return n.post("./clients",{client:e.client,clients:i},function(n,r){e.clients(n),t()},"json"),!1},s.submitOrder=function(e){arguments[3]();var t=(arguments[4],n.parseJSON(r.toJSON(e)));return n.post("./order",t,function(t,n){t.items.forEach(function(e){e.historicTrades=[]}),console.log("get post result"),r.mapping.fromJS(t,{},e)},"json"),!1}};return function(e,o){function a(){setTimeout(function(){o.update()},100)}function c(){var e=p.filter(function(e){return e.client().indexOf(g)>=0});l.orders(e)}function u(){var e=setTimeout(function(){for(var e=1;e<b.length;e++)clearTimeout(b[e]);b=[],""!=g&&(n.ajax("./ordersByName",{data:{client:g},type:"GET",success:function(e,t){/^\s?$/.test(g)||l.orders(l.getObservableOrders(e))},dataType:"json"}),console.log("i am searching "+g))},1e3);b.push(e)}var l=this,d=t();l.updateReservedOrders=function(e){p=e},l.sortOrders=function(e){e.sort(function(e,t){var n=e.status(),r=t.status();return n==r?e.createDate()<=t.createDate()?1:-1:n<r?-1:1})},l.getObservableOrders=function(e){var t=[];return e.forEach(function(e){t.push(new s(e,o))}),t};var f=l.getObservableOrders(e);l.orders=r.observableArray(f),l.toggleClientView=function(e,t,r){n(r.target).toggleClass("icon-eyeslash");var i=n(".orders--reckoning");n(r.target).hasClass("icon-eyeslash")?i.addClass("isClientView"):i.removeClass("isClientView"),o.update()},l.markDone=function(e){if("1RECEIVED"!=e.status()||"3PACKED"==e.packingStatus){arguments[3]();var t=arguments[4],r=(arguments[1],e._id()),i=e.status(),s="1RECEIVED";"1RECEIVED"==i?s="2SENT":"2SENT"==i&&(s="3DONE"),n.ajax("./orderStatus/"+r,{success:function(r,i){e.status(s);var o=l.orders();""==n("#search-reckoningOrders").val()?("3DONE"==s&&e.createDate()<d&&l.removeDoneOrder(e),l.sortOrders(o),l.orders(o),l.updateReservedOrders(o)):m=!0,t()},data:{status:s},dataType:"json",type:"PUT"})}},l.submitOrders=function(){arguments[3]();var e=arguments[4],t=l.orders(),s=n.parseJSON(r.toJSON(t));if(Array.isArray(s)&&s.length>0){var o=[],a=s.filter(function(e,t){var n=!1;if(e.isChanged)n=!0;else for(var r=0;r<e.items.length;r++)if(e.items[r].isChanged){n=!0;break}return n&&o.push(t),n});a.length>0?(m=!!v,n.post("./orders",{orders:a},function(s,a){s.forEach(function(e,s){var a=o[s];n.isArray(e.items)&&0==e.items.length&&(e.items=[{},{},{}]),e.items.forEach(function(e){e.historicTrades=[]}),r.mapping.fromJS(e,{items:{create:function(e){return new i(e.data)}}},t[a]),t[a].isChanged=!1}),e()},"json")):e()}return!1},l.afterRender=function(){a()},l.afterOrderRender=function(){n("#reckoningOrdersBody").children().length===l.orders().length&&a()},l.addOrder=function(){var e=new s(null,o);l.orders.unshift(e),l.updateReservedOrders(l.orders()),o.update(),n(window).scrollTop(0)},l.addExistingOrder=function(e){l.orders.push(doneOrder)},l.removeDoneOrder=function(e){l.orders.remove(e)},l.removeOrder=function(e){arguments[3]();var t=arguments[4],r=e._id();if(l.orders.remove(e),""==r)return void t();n.ajax("./order/"+r,{success:function(e,n){t()},dataType:"json",type:"DELETE"}),l.updateReservedOrders(l.orders()),o.update()};var p,m,v,g,h;l.searchOrders=function(e,t){var r=n(t.target).val(),i=r.match(/(\s*)([\u4E00-\u9FA5\uF900-\uFA2D\w]+[\u4E00-\u9FA5\uF900-\uFA2D\w ]*)/);p||(p=l.orders()),null!=i?(v=!0,g=i[2],""==i[1]?c():u()):/^\s?$/.test(r)&&(g="",v=!1,h=!1,m&&!h?(h=!0,n.getJSON("./reckoningOrdersJson",function(e,t){m=!1,h=!1;var n=l.getObservableOrders(e);l.orders(n),p=n})):(l.sortOrders(p),l.orders(p)))};var b=[]}}),define("IncomeList",["common"],function(e){var t=e.$,n=e.ko;return n.mapping=e.mapping,function(e,r){var r=r,i=this;i.incomeList=n.observableArray(e),i.setIncomeList=function(e){i.incomeList(e)},i.formatPrice=function(e){return e?(+e).toFixed(1):"?"},i.toggleTotalView=function(e,n,r){t(r.target).toggleClass("icon-eyeopen");var i=t(r.target).closest(".orderitem-cnt");t(r.target).hasClass("icon-eyeopen")?i.addClass("isShow"):i.removeClass("isShow")},i.afterRender=function(){r.update()}}}),function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("clipboard",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Clipboard=e()}}(function(){var e;return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function r(e,t){for(;e&&e.nodeType!==i;){if(e.matches(t))return e;e=e.parentNode}}var i=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var s=Element.prototype;s.matches=s.matchesSelector||s.mozMatchesSelector||s.msMatchesSelector||s.oMatchesSelector||s.webkitMatchesSelector}t.exports=r},{}],2:[function(e,t,n){function r(e,t,n,r,s){var o=i.apply(this,arguments);return e.addEventListener(n,o,s),{destroy:function(){e.removeEventListener(n,o,s)}}}function i(e,t,n,r){return function(n){n.delegateTarget=s(n.target,t),n.delegateTarget&&r.call(e,n)}}var s=e("./closest");t.exports=r},{"./closest":1}],3:[function(e,t,n){n.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||n.node(e[0]))},n.string=function(e){return"string"==typeof e||e instanceof String},n.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},{}],4:[function(e,t,n){function r(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!a.string(t))throw new TypeError("Second argument must be a String");if(!a.fn(n))throw new TypeError("Third argument must be a Function");if(a.node(e))return i(e,t,n);if(a.nodeList(e))return s(e,t,n);if(a.string(e))return o(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function i(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function s(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function o(e,t,n){return c(document.body,e,t,n)}var a=e("./is"),c=e("delegate");t.exports=r},{"./is":3,delegate:2}],5:[function(e,t,n){function r(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var r=window.getSelection(),i=document.createRange();i.selectNodeContents(e),r.removeAllRanges(),r.addRange(i),t=r.toString()}return t}t.exports=r},{}],6:[function(e,t,n){function r(){}r.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function r(){i.off(e,r),t.apply(n,arguments)}var i=this;return r._=t,this.on(e,r,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;for(r;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var s=0,o=r.length;s<o;s++)r[s].fn!==t&&r[s].fn._!==t&&i.push(r[s]);return i.length?n[e]=i:delete n[e],this}},t.exports=r},{}],7:[function(t,n,r){!function(i,s){if("function"==typeof e&&e.amd)e(["module","select"],s);else if(void 0!==r)s(n,t("select"));else{var o={exports:{}};s(o,i.select),i.clipboardAction=o.exports}}(this,function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(e){return e&&e.__esModule?e:{default:e}}(t),i="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof2(e)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.resolveOptions(t),this.initSelection()}return s(e,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,r.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,r.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":i(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}();e.exports=o})},{select:5}],8:[function(t,n,r){!function(i,s){if("function"==typeof e&&e.amd)e(["module","./clipboard-action","tiny-emitter","good-listener"],s);else if(void 0!==r)s(n,t("./clipboard-action"),t("tiny-emitter"),t("good-listener"));else{var o={exports:{}};s(o,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=o.exports}}(this,function(e,t,n,r){function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof2(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof2(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}var u=i(t),l=i(n),d=i(r),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=function(e){function t(e,n){s(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.resolveOptions(n),r.listenClick(e),r}return a(t,e),f(t,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText}},{key:"listenClick",value:function(e){var t=this;this.listener=(0,d.default)(e,"click",function(e){return t.onClick(e)})}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new u.default({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})}},{key:"defaultAction",value:function(e){return c("action",e)}},{key:"defaultTarget",value:function(e){var t=c("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return c("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach(function(e){n=n&&!!document.queryCommandSupported(e)}),n}}]),t}(l.default);e.exports=p})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)}),define("ClientsModel",["common","clipboard"],function(e,t){var n=e.$,r=e.ko;r.mapping=e.mapping;var i=function(e){var t=this;t.recipient=r.observable(e?e.recipient:""),t.address=r.observable(e?e.address:""),t.phone=r.observable(e?e.phone:""),t.isActive=r.observable(!(!e||!e.isActive)),t.defaultAddressMarkCss=r.pureComputed(function(){return t.isActive()?"icon-radio-selected":"icon-radio"}),t.defaultAddressCss=r.pureComputed(function(){return t.isActive()?"isActive":""}),t.isChanged=!1,t.recipient.subscribe(function(e){t.isChanged=!0}),t.address.subscribe(function(e){t.isChanged=!0}),t.phone.subscribe(function(e){t.isChanged=!0}),t.isActive.subscribe(function(e){t.isChanged=!0})},s=function(e,t){var n=this;n._id=r.observable(e?e._id:""),n.name=r.observable(e?e.name:""),n.createDate=e&&e.createDate?e.createDate:"",n.isActive=r.observable(!(!e||!e.isActive)),n.mailType=e&&e.mailType?e.mailType:"",n.mailDisplayType=function(e){return"sf"==e?"顺丰":"common"==e?"韵达":void 0},n.displayPrintName=function(e){e=e();var t="";return""==e?"":"sf"==n.mailType?(t="顺丰",e+" - "+t):"common"==n.mailType?(t="韵达",e+" - "+t):e},e&&Array.isArray(e.addresses)&&e.addresses.length>0?n.addresses=r.observableArray(e.addresses.map(function(e){return new i(e)})):n.addresses=r.observableArray([new i({isActive:!0})]),n.isChanged=!1,n.name.subscribe(function(e){n.isChanged=!0}),n.addresses.subscribe(function(e){n.isChanged=!0}),n.addAddress=function(){n.addresses().length>0?n.addresses.unshift(new i):n.addresses.unshift(new i({isActive:!0})),t.update()},n.removeAddress=function(e){n.addresses.remove(e),t.update()},n.markDefault=function(e,t){t.addresses().forEach(function(e){return e.isActive(!1)}),e.isActive(!0)}};return function(e,o){function a(){var e=p.clients(),t=e.filter(function(e){e.name();return e.isActive()&&"common"==e.mailType}),n=t.filter(function(e){var t=e.name();return t.indexOf("-")>=0||t.indexOf("－")>=0}),r=[];n.forEach(function(e){var t=e.name(),n=t.indexOf("-"),i=t.indexOf("－"),s=-1;s=n>-1&&i>-1?Math.min(n,i):n>-1?n:i;var o=t.slice(0,s);r.find(function(e){return e==o})||r.push(o)});var i=[];r.forEach(function(e){var t=n.filter(function(t){return t.name().startsWith(e)}),r=c(e,t);i.push(r)});var s=t.filter(function(e){var t=e.name();return t.indexOf("-")==-1&&t.indexOf("－")==-1});if(Array.isArray(s)&&s.length>0){var o=c("自己的",s);i.push(o)}return i}function c(e,t){var n="";return t.forEach(function(e){var t=e.addresses().find(function(e){return e.isActive()}),r=t.recipient(),i=t.phone(),s=t.address();""!=r&&""!=i&&""!=s&&(n+=t.recipient()+"，"+t.phone()+"，"+t.address()+"；")}),{name:e+"：",receives:n}}function u(e){var t=[];return e.forEach(function(e){t.push(new s(e,o))}),t}function l(){setTimeout(function(){o.update()},100)}function d(){var e=m.filter(function(e){return e.name().indexOf(h)>=0});p.clients(e)}function f(){var e=setTimeout(function(){for(var e=1;e<y.length;e++)clearTimeout(y[e]);y=[],""!=h&&(n.ajax("./clientsByKeywords",{data:{keywords:h},type:"GET",success:function(e,t){/^\s?$/.test(h)||p.clients(u(e))},dataType:"json"}),console.log("i am searching "+h))},1e3);y.push(e)}var p=this;p.clients=r.observableArray(u(e)),p.senders=r.observableArray(a()),p.setClients=function(e){p.clients(u(e)),p.senders(a())},p.setClientViews=function(e){p.clients(e)},p.setSenders=function(){p.senders(a())},p.addClient=function(){p.clients.unshift(new s(null,o)),l()},p.removeClient=function(e){arguments[3]();var t=arguments[4],r=e._id();if(p.clients.remove(e),""==r)return o.update(),void t();n.ajax("./client/"+r,{success:function(e,n){t(),l()},dataType:"json",type:"DELETE"}),v=!!g},p.submitClients=function(e){arguments[3]();var t=arguments[4],s=p.clients();if(Array.isArray(s)&&s.length>0){var o=[],a=s.filter(function(e,t){var n=!1;if(""!=e.name)if(e.isChanged)n=!0;else{var r=e.addresses(),i=r.find(function(e){return e.isChanged});i&&(n=!0)}return n&&o.push(t),n});if(a.length>0){v=!!g;var c=n.parseJSON(r.toJSON(a));n.post("./clients",{clients:c},function(e,a){e.forEach(function(e,t){var a=o[t];n.isArray(e.addresses)&&0==e.addresses.length&&(e.addresses=[{}]),r.mapping.fromJS(e,{addresses:{create:function(e){return new i(e.data)}}},s[a]),s[a].isChanged=!1}),g||p.setSenders(),t()},"json")}else t()}return!1},p.afterRender=function(){l()},p.afterSenderRender=function(){if(n(".senders").children().length===p.senders().length){new t(".sender-copy",{text:function(e){return n(e).siblings(".sender-receives").val()}});l()}},p.afterClientRender=function(){if(n(".allclients").children().length===p.clients().length){new t(".sender-singleCopy",{text:function(e){var t=n(e).closest(".client").find(".client-address.isActive")
;return t.find(".recipient>input").val()+"，"+t.find(".phone>input").val()+"，"+t.find(".addressDetail>input").val()+"；"}});l()}};var m,v,g,h,b;p.searchClients=function(e,t){var r=n(t.target).val(),i=r.match(/(\s*)([\u4E00-\u9FA5\uF900-\uFA2D\w]+[\u4E00-\u9FA5\uF900-\uFA2D\w ]*)/);m||(m=p.clients()),null!=i?(g=!0,h=i[2],""==i[1]?d():f()):/^\s?$/.test(r)&&(h="",g=!1,b=!1,v&&!b?(b=!0,n.getJSON("./clientsJson",function(e,t){v=!1,b=!1,p.setClients(e),m=p.clients()})):p.clients(m))};var y=[]}}),define("ProductsModel",["common"],function(e){function t(e){var t=this;t._id=e._id,t.client=e.client,t.name=e.name,t.note=e.note,t.buyPrice=s.observable(e&&!isNaN(e.buyPrice)?e.buyPrice:""),t.sellPrice=s.observable(e&&!isNaN(e.sellPrice)?e.sellPrice:"")}function n(e,n){var r=this;r._id=s.observable(e&&e._id?e._id:""),r.name=s.observable(e&&e.name?e.name:""),r.status=s.observable(e&&e.status?e.status:"MANUAL"),r.buyPrice=s.observable(e&&!isNaN(e.buyPrice)?e.buyPrice:""),r.sellPrice=s.observable(e&&!isNaN(e.sellPrice)?e.sellPrice:""),r.modifiedDate=s.observable(e?e.modifiedDate:""),r.displayDate=s.observable(e?e.displayDate:""),r.isChanged=!1,r.name.subscribe(function(t){r.isChanged=!0,e&&e.name&&t!=e.name&&r.status("MANUAL")}),r.buyPrice.subscribe(function(t){r.isChanged=!0,e&&e.buyPrice&&t!=e.buyPrice&&"MANUAL"!=e.status()&&r.status("MODIFIED")}),r.sellPrice.subscribe(function(t){r.isChanged=!0,e&&e.sellPrice&&t!=e.sellPrice&&"MANUAL"!=e.status()&&r.status("MODIFIED")}),r.activeClients=s.observableArray([]),r.isOpen=s.observable(!1),r.getActiveClients=function(e,s,o){var a=i(o.target).closest(".table-row").children(".clientInfo");if(r.isOpen())a.slideUp("fast",function(){r.isOpen(!1),n.update()});else{arguments[3]();var c=arguments[4];i.getJSON("./activeClientsByProduct",{product:r.name()},function(e,i){if("success"==i&&Array.isArray(e)&&e.length>0){var s=e.map(function(e){return new t(e)});r.activeClients(s)}else r.activeClients([]);a.slideDown("fast",function(){r.isOpen(!0),c(),n.update()})})}},r.updateClientPrice=function(){arguments[3]();var e=arguments[4],t=r.activeClients(),n=i.parseJSON(s.toJSON(t));return i.post("./updateClientPrice",{clientProducts:n},function(t,n){e()},"json"),!1},r.getExpandCollapse=function(){return r.isOpen()?"icon-collapse":"icon-expand"}}function r(e,t){function r(e){var r=[];if(Array.isArray(e))var r=e.map(function(e){return new n(e,t)});return r}function o(){setTimeout(function(){t.update()},100)}function a(){var e=l.filter(function(e){return e.name().indexOf(p)>=0});u.products(e)}function c(){var e=setTimeout(function(){for(var e=1;e<v.length;e++)clearTimeout(v[e]);v=[],""!=p&&(i.ajax("./productsByKeywords",{data:{keywords:p},type:"GET",success:function(e,t){/^\s?$/.test(p)||u.setProducts(e)},dataType:"json"}),console.log("i am searching "+p))},1e3);v.push(e)}var t=t,u=this;u.setProducts=function(e){u.products(r(e))},u.products=s.observableArray(r(e)),u.submitProducts=function(){arguments[3]();var e=arguments[4],t=u.products(),n=i.parseJSON(s.toJSON(t));if(Array.isArray(n)&&n.length>0){var r=[],o=n.filter(function(e,t){var n=!1;return""!=e.name&&e.isChanged&&(n=!0),n&&r.push(t),n});o.length>0?(d=!!f,i.post("./products",{products:o},function(n,i){n.forEach(function(e,n){var i=r[n];s.mapping.fromJS(e,null,t[i]),t[i].isChanged=!1}),e()},"json")):e()}return!1},u.addProduct=function(){var e=new n(null,t);u.products.unshift(e),o(),i(window).scrollTop(0)},u.removeProduct=function(e){arguments[3]();var t=arguments[4],n=e._id();if(u.products.remove(e),""==n)return void t();i.ajax("./product/"+n,{success:function(e,n){t(),o()},dataType:"json",type:"DELETE"}),d=!!f},u.afterRender=function(){o()},u.afterProductRender=function(){i("#productsbody").children().length===u.products().length&&o()};var l,d,f,p,m;u.searchProducts=function(e,t){var n=i(t.target).val(),r=n.match(/(\s*)([\u4E00-\u9FA5\uF900-\uFA2D\w]+[\u4E00-\u9FA5\uF900-\uFA2D\w ]*)/);l||(l=u.products()),null!=r?(f=!0,p=r[2],""==r[1]?a():c()):/^\s?$/.test(n)&&(p="",f=!1,m=!1,d&&!m?(m=!0,i.getJSON("./productsJson",function(e,t){d=!1,m=!1,u.setProducts(e),l=u.products()})):u.products(l))};var v=[]}var i=e.$,s=e.ko;return s.mapping=e.mapping,r}),define("../js/main",["common","ReceivedOrders","ItemsModel","ReckoningOrders","IncomeList","ClientsModel","ProductsModel"],function(e,t){function n(){function n(e,t,n){var r=n.buyComputing,i=n.sellComputing;"function"==typeof e&&(e=c.mapping.toJS(e())),"function"==typeof t&&(t=c.mapping.toJS(t()));var s=e.filter(function(e){return e.sellPrice||e.buyPrice});return t.forEach(function(e){"1RECEIVED"!=e.status&&"2SENT"!=e.status||e.items.forEach(function(t){var n=s.find(function(e){return e.name==t.name});n&&(i&&!t.sellPrice&&n.sellPrice?(t.sellPrice="?"+n.sellPrice,t.isDoubtSellPrice=!0,e.isChanged=!0):!i&&t.isDoubtSellPrice&&(t.sellPrice=null,t.isDoubtSellPrice=!1),r&&!t.buyPrice&&n.buyPrice?(t.buyPrice="?"+n.buyPrice,t.isDoubtBuyPrice=!0,e.isChanged=!0):!r&&t.isDoubtBuyPrice&&(t.buyPrice=null,t.isDoubtBuyPrice=!1))})}),t}function r(e){switch(a(".swiper-slide")[e].id){case"receivedOrders":l.purchaseItems=!0,l.reckoningOrders=!0,l.clients=!0,l.products=!0;break;case"purchaseItems":l.receivedOrders=!0,l.reckoningOrders=!0;break;case"reckoningOrders":l.receivedOrders=!0,l.purchaseItems=!0,l.incomeList=!0,l.clients=!0,l.products=!0;break;case"products":l.reckoningOrders=!0}}function i(){var e=a(".swiper-slide")[d.activeIndex].id;"receivedOrders"==e&&a.getJSON("./receivedOrdersJson",function(e,t){h.setOrders(e,!0)}),"reckoningOrders"==e&&a.getJSON("./reckoningOrdersJson",function(e,t){var n=p.getObservableOrders(e);p.orders(n)})}function s(){var e=a(".swiper-slide")[d.activeIndex].id;"incomeList"!=e&&"reckoningOrders"!=e||a.getJSON("./receivedOrdersJson",function(e,t){h.setOrders(e,!0)}),"receivedOrders"!=e&&"reckoningOrders"!=e||a.getJSON("./purchaseItemsJson",function(e,t){f.setItems(e.items,!0,!0)}),"receivedOrders"!=e&&"incomeList"!=e||a.getJSON("./reckoningOrdersJson",function(e,t){var n=p.getObservableOrders(e);p.orders(n)}),"reckoningOrders"==e&&a.getJSON("./incomeListJson",function(e,t){m.setIncomeList(e)}),"reckoningOrders"==e&&a.getJSON("./clientsJson",function(e,t){v.setClients(e)})}function o(){return new Promise(function(e,t){a.getJSON("./user/"+USER_ID,function(t,n){e(t)})})}var a=e.$,c=e.ko,u=(e.mapping,e.Swiper),l={receivedOrders:!1,purchaseItems:!1,reckoningOrders:!1,incomeList:!1,clients:!1,products:!1},d=new u(".swiper-container",{autoHeight:!0,spaceBetween:30,pagination:".swiper-pagination",paginationClickable:!0,simulateTouch:!1,shortSwipes:!1,longSwipes:!1,paginationBulletRender:function(e,t){var n="";switch(a(".swiper-slide")[e].id){case"receivedOrders":n="接单";break;case"purchaseItems":n="采购";break;case"reckoningOrders":n="算账";break;case"incomeList":n="收益";break;case"clients":n="客户";break;case"products":n="产品"}return'<span class="'+t+'">'+n+"</span>"}});e.initTapEvent({updateAllData:s,updateCurrentData:i,setViewModelStatus:r,swiper:d});var f,p,m,v,g,h=new t(orders);h.setSwiper(d),c.applyBindings(h,a("#receivedOrders")[0]);var b=o();b.catch(function(e){}),require(["common","ItemsModel","ReckoningOrders","IncomeList","ClientsModel","ProductsModel"],function(e,t,i,s,o,a){var c=e.$,u=e.ko,y=new Promise(function(e,n){c.getJSON("./purchaseItemsJson",function(n,r){f=new t(n.items,d),u.applyBindings(f,c("#purchaseItems")[0]),e(f)})});Promise.all([b,y]).then(function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1],s=Array.isArray(n.tags)?n.tags:[];c(".hidden-tag").tag({tags:s,updateTag:function(e,t,n){if(t!=n){if(Array.isArray(i.allItems)&&i.allItems.length>0){var s=i.allItems.find(function(t){return t._id==e});if(s.tag=n,s){var o=[];i.allItems.forEach(function(e){o.indexOf(e.tag)<0&&e.tag&&o.push(e.tag)}),i.tags(o)}}c.post("./itemtag",{itemName:e,oldTag:t,newTag:n},function(e,t){r(d.activeIndex)},"json")}}})});var O;access.products&&(O=new Promise(function(e,t){c.getJSON("./productsJson",function(t,n){e(t),g=new a(t,d),u.applyBindings(g,c("#products")[0])})}));new Promise(function(e,t){function r(t){p=new i(t,d),e(p),u.applyBindings(p,c("#reckoningOrders")[0])}c.getJSON("./reckoningOrdersJson",function(e,t){access.products?Promise.all([b,O]).then(function(t){var i=_slicedToArray(t,2),s=i[0];r(n(i[1],e,{buyComputing:s.buyComputing,sellComputing:s.sellComputing}))}):r(e)})});c.getJSON("./incomeListJson",function(e,t){m=new s(e,d),u.applyBindings(m,c("#incomeList")[0])}),access.clients&&c.getJSON("./clientsJson",function(e,t){v=new o(e,d),u.applyBindings(v,c("#clients")[0])}),c(document).on("keydown",function(e){var t=c(".swiper-slide")[d.activeIndex].id;if(13==e.keyCode){c(document.activeElement).blur();var n=c("#"+t+" .action-enter");return setTimeout(function(){n.trigger("click")},100),!1}}),d.params.onSlideChangeStart=function(e){switch(c(".swiper-slide")[e.activeIndex].id){case"receivedOrders":l.receivedOrders&&c.getJSON("./receivedOrdersJson",function(e,t){h.setOrders(e,!0),l.receivedOrders=!1});break;case"purchaseItems":l.purchaseItems&&c.getJSON("./purchaseItemsJson",function(e,t){f.setItems(e.items,!0,!0),l.purchaseItems=!1});break;case"reckoningOrders":l.reckoningOrders&&c.getJSON("./reckoningOrdersJson",function(e,t){if(access.products)b.then(function(t){var r=n(g.products,e,{buyComputing:t.buyComputing,sellComputing:t.sellComputing}),i=p.getObservableOrders(r);p.orders(i)});else{var r=p.getObservableOrders(e);p.orders(r)}l.reckoningOrders=!1});break;case"incomeList":l.incomeList&&c.getJSON("./incomeListJson",function(e,t){m.setIncomeList(e),l.incomeList=!1});break;case"clients":l.clients&&c.getJSON("./clientsJson",function(e,t){v.setClients(e),l.clients=!1});break;case"products":l.products&&c.getJSON("./productsJson",function(e,t){g.setProducts(e),l.products=!1})}setTimeout(function(){e.update(),c(window).scrollTop(0)},100)}}),require(["angularApp"],function(e){e().bootstrap(a("#settings")[0],["settings"]),a(".icon-cog").colorbox({inline:!0,width:335,height:200,scrolling:!1,close:"",top:0,onComplete:function(){setInterval(function(){a.colorbox.resize()},200)},onClosed:function(){b=o(),"reckoningOrders"==a(".swiper-slide")[d.activeIndex].id&&access.products&&b.then(function(e){var t=n(g.products,p.orders,{buyComputing:e.buyComputing,sellComputing:e.sellComputing}),r=p.getObservableOrders(t);p.orders(r)})}}),a(window).scroll(function(){var e=a(window).scrollTop();a(".searchbox").css("top",e)})}),a(".icon-signout").bind("click",function(){return a(".mask").addClass("isLoginShow"),a.get("./logout",function(e,t){e.success&&a.get("./content",function(e,t){setTimeout(function(){a("#container").html(e),a(".mask").removeClass("isLoginShow")},1e3)},"html")},"json"),!1})}return n});