"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _slicedToArray=function(){function e(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("ReceivedOrders",["common"],function(e){var t=e.$,n=e.ko;n.mapping=e.mapping;var r=function(e){var t=this;t.name=n.observable(e&&e.name?e.name:""),t.quantity=n.observable(e&&e.quantity?e.quantity:"1"),t.note=n.observable(e&&e.note?e.note:""),t.buyPrice=e&&!isNaN(e.buyPrice)?e.buyPrice:"",t.sellPrice=e&&!isNaN(e.sellPrice)?e.sellPrice:"",t.profit=e&&e.profit?e.profit:"",t.isDone=!(!e||void 0===e.isDone)&&e.isDone,t.tag=e&&e.tag?e.tag:"",t.isChanged=!1,t.name.subscribe(function(e){t.isChanged=!0}),t.quantity.subscribe(function(e){t.isChanged=!0}),t.note.subscribe(function(e){t.isChanged=!0})},i=function(e){var i=this;i._id=n.observable(e&&e._id?e._id:""),i.client=n.observable(e&&e.client?e.client:""),i.packingStatus=n.observable(e&&e.packingStatus?e.packingStatus:"1ISREADY"),i.rate=e&&e.rate?e.rate:null,i.postage=e&&e.postage?e.postage:0,i.buyPrice=e&&e.buyPrice?e.buyPrice:"",i.sellPrice=e&&e.sellPrice?e.sellPrice:"",i.profit=e&&e.profit?e.profit:"",i.status=e&&e.status?e.status:"1RECEIVED",i.createDate=e&&e.createDate?e.createDate:"";var s=[];if(e&&t.isArray(e.items)&&e.items.length>0)e.items.forEach(function(e){s.push(new r(e))});else for(var a=0;a<3;a++)s.push(new r);i.items=n.observableArray(s),i.isChanged=!1,i.client.subscribe(function(e){i.isChanged=!0}),i.items.subscribe(function(e){i.isChanged=!0}),i.orderPackingStatus=n.pureComputed(function(){return"3PACKED"==i.packingStatus()?"font-green":"2NOTREADY"==i.packingStatus()?"font-yellow":"font-black"}),i.orderReadyStatus=n.pureComputed(function(){return"2NOTREADY"==i.packingStatus()?"icon-thumbsdown font-yellow":"icon-thumbsup font-black"})};return function(e,s){function a(e){var t=[];if(Array.isArray(e)&&e.length>0)e.forEach(function(e){t.push(new i(e))});else for(var n=0;n<30;n++)t.push(new i);return t}function o(e){e.sort(function(e,t){var n=e.packingStatus(),r=t.packingStatus();return n==r?e.createDate<=t.createDate?1:-1:n<r?-1:1})}var c=s,u=this;u.setSwiper=function(e){c=e,c.update()};var d=a(e);u.orders=n.observableArray(d),u.setOrders=function(e,t){u.orders(a(e)),c.update()},u.addItem=function(e){e.items.unshift({name:"",quantity:1,note:"",buyPrice:"",sellPrice:"",isDone:!1}),c.update()},u.removeItem=function(e,t){t.items.remove(e),c.update()},u.submitOrder=function(e){arguments[3]();var r=arguments[4];console.log("post request....");var i=n.mapping.toJS(e);return t.post("./order",i,function(t,i){console.log("get post result"),n.mapping.fromJS(t,{},e),r()},"json"),!1},u.submitOrders=function(){arguments[3]();var e=arguments[4],i=u.orders(),s=t.parseJSON(n.toJSON(i));if(Array.isArray(s)&&s.length>0){var a=[],o=s.filter(function(e,t){var n=!1;if(""!=e.client)if(e.isChanged)n=!0;else for(var r=0;r<e.items.length;r++)if(e.items[r].isChanged){n=!0;break}return n&&a.push(t),n});o.length>0?t.post("./orders",{orders:o},function(s,o){s.forEach(function(e,s){var o=a[s];t.isArray(e.items)&&0==e.items.length&&(e.items=[{},{},{}]),n.mapping.fromJS(e,{items:{create:function(e){return new r(e.data)}}},i[o]),i[o].isChanged=!1}),e()},"json"):e()}return!1},u.markPackingStatus=function(e){arguments[3]();var n=arguments[4],r=(arguments[1],e._id()),i=e.packingStatus(),s=t(arguments[2].target),a="";if(s.hasClass("icon-leaf")?"1ISREADY"==i?a="3PACKED":"3PACKED"==i&&(a="1ISREADY"):a="1ISREADY"==i||"3PACKED"==i?"2NOTREADY":"1ISREADY",""==a)return void n();t.ajax("./packingStatus/"+r,{success:function(r,i){if(e.packingStatus(a),""==t("#search-receivedOrders").val()){var s=u.orders();o(s),u.orders(s)}n()},data:{packingStatus:a},dataType:"json",type:"PUT"})},u.addOrder=function(){var e=new i;u.orders.unshift(e),c.update(),t(window).scrollTop(0)},u.removeOrder=function(e){arguments[3]();var n=arguments[4],r=e._id();if(u.orders.remove(e),""==r)return void n();t.ajax("./order/"+r,{success:function(e,t){n()},dataType:"json",type:"DELETE"}),c.update()};var e=null;u.searchOrders=function(n,r){var i=t(r.target).val();if(null==e&&(e=u.orders()),""==i){o(e);var s=e}else var s=e.filter(function(e){return e.client().indexOf(i)>=0});u.orders(s),setTimeout(function(){c.update()},100)},u.afterRender=function(){c.update(),t(".mask").removeClass("isShow")}}}),define("ItemsModel",["common"],function(e){var t=e.$,n=e.ko;n.mapping=e.mapping;var r=function(e){var t=this;t._id=e._id,t.client=e.client,t.name=e.name,t.note=e.note,t.quantity=e.quantity,t.isDone=n.observable(e.isDone)},i=function(e,i){function s(e){var t=e.findIndex(function(e){return e._id==a._id&&e.tag==a.tag()});t>-1&&(e[t]=n.mapping.toJS(a))}var a=this;a._id=e?e._id:"",a.quantity=e?e.quantity:"",a.tag=n.observable(e&&e.tag?e.tag:""),a.purchaseDetail=n.observableArray(e?e.purchaseDetail:[]),a.subItems=n.observableArray([]),a.updateSubItems=function(e){var t=[];Array.isArray(e)&&e.length>0&&e.forEach(function(e){t.push(new r(e))}),a.subItems(t)},a.hasItemDetail=function(e){return a.subItems().length>0},a.restCount=n.pureComputed(function(){var e=a.purchaseDetail(),t=0,n=0;return e.forEach(function(e){e.isDone?t=e.quantity:n=e.quantity}),t<a.quantity&&0!=t?a.quantity-t:""}),a.displaySubItems=n.pureComputed(function(){return a.subItems().length>0}),a.markDone=function(e,r,i){arguments[3]();var o=arguments[4],c=n.mapping.toJS(e),u=!0;c.purchaseDetail.forEach(function(e){e.isDone||(u=!1)}),t.post("./item",{itemTag:c.tag,itemName:c._id,isDone:!u},function(t,n){e.purchaseDetail(t.purchaseDetail),s(r.allItems);a.displaySubItems&&a.subItems().forEach(function(e){e.isDone(!u)}),o()},"json")},a.markItemStatus=function(){var e=a.purchaseDetail(),t=0,n=0;return e.forEach(function(e){e.isDone?t=e.quantity:n=e.quantity}),n==a.quantity?"":t==a.quantity?"font-green":"font-yellow"},a.markSubItemDone=function(e,r,i){arguments[3]();var o=arguments[4],c=arguments[5],u=n.mapping.toJS(e);u.isDone=!u.isDone,u.tag=r.tag(),t.post("./subitem",u,function(t,n){e.isDone(!e.isDone()),a.purchaseDetail(t.purchaseDetail),s(c.allItems),a.subItems().forEach(function(t){t.client==e.client&&t.isDone(e.isDone())}),o()},"json")},a.getSubName=function(e){return"item"+e.isDone},a.getSubItems=function(e,r,s){var o=n.mapping.toJS(e);if(e.isSubItemsOpen)t(s.target).parents(".orderitem-cnt").next().slideUp("fast",function(){e.isSubItemsOpen=!1,i.update()});else{arguments[3]();var c=arguments[4];t.getJSON("./subitems",{itemName:o._id,itemTag:o.tag},function(n,r){"success"==r?a.updateSubItems(n):e.subItems([]),t(s.target).parents(".orderitem-cnt").next().slideDown("fast",function(){e.isSubItemsOpen=!0,c()})})}},a.isSubItemsOpen=!1};return function(e,r){function s(e){var t="function"==typeof e.purchaseDetail?e.purchaseDetail():e.purchaseDetail,n=0,r=0;return t.forEach(function(e){e.isDone?n=e.quantity:r=e.quantity}),r==e.quantity?-1:n==e.quantity?1:0}function a(e,t){if(e.tag<t.tag)return-1;if(e.tag>t.tag)return 1;var n=s(e),r=s(t);if(n<r)return-1;if(n>r)return 1;var i=e._id.substr(0,1),a=t._id.substr(0,1);return i<a?-1:i>a?1:0}function o(e,t){var n=s(e),r=s(t);if(n<r)return-1;if(n>r)return 1;if(e.tag<t.tag)return-1;if(e.tag>t.tag)return 1;var i=e._id.substr(0,1),a=t._id.substr(0,1);return i<a?-1:i>a?1:0}function c(e,t,n){var s=[],c=[];return Array.isArray(e)&&e.length>0&&("status"==n?e.sort(o):e.sort(a),e.forEach(function(e){s.push(new i(e,r)),t&&c.indexOf(e.tag)<0&&e.tag&&c.push(e.tag)})),[s,c]}var u=this;u.allItems=[],u.tags=n.observableArray(),u.items=n.observableArray(),u.setItems=function(e,i,s){var a=!1;i&&(t(".link-tag.all").addClass("isActive"),a=!0);var o=c(e,a),d=_slicedToArray(o,2),e=d[0],f=d[1];u.items(e),i&&(u.tags(f),u.allItems=u.items().map(function(e){return n.mapping.toJS(e)})),s&&setTimeout(function(){t(".hidden-tag").tag()},10),setTimeout(function(){r.update()},100)},u.setItems(e,!0,!1),u.refreshItems=function(e){var r=u.items().map(function(e){return n.mapping.toJS(e)}),i=t(".link-tag.isActive");i.hasClass("all")||(r=r.filter(function(e){return e.tag==i.text()}));var s=c(r,!1,e),a=_slicedToArray(s,2),o=a[0];a[1];u.items(o),setTimeout(function(){t(".hidden-tag").tag()},10)},u.filterItems=function(e,n,i){var s=t(i.target);if(t(".link-tag.isActive").removeClass("isActive"),s.addClass("isActive"),s.hasClass("all"))u.setItems(u.allItems,!0,!0);else{var a=u.allItems.filter(function(t){return t.tag==e});u.setItems(a,!1,!0)}r.update(),t(document).click()},u.afterRender=function(){r.update()}}}),define("ReckoningOrders",["common"],function(e){function t(){var e=Date.now(),t=(new Date).getDay(),n=e-24*(t+7)*60*60*1e3;return new Date(new Date(n).setHours(0,0,0,0))}var n=e.$,r=e.ko;r.mapping=e.mapping;var i=function(e){var t=this;t.name=r.observable(e&&e.name?e.name:""),t.quantity=r.observable(e&&e.quantity?e.quantity:"1"),t.buyPrice=r.observable(e&&!isNaN(e.buyPrice)?e.buyPrice:""),t.sellPrice=r.observable(e&&!isNaN(e.sellPrice)?e.sellPrice:""),t.profit=e&&e.profit?e.profit:"",t.note=e&&e.note?e.note:"",t.isDone=!(!e||!e.isDone)&&e.isDone,t.tag=e&&e.tag?e.tag:"",t.historicTrades=r.observableArray([]),t.isHistoricTradesOpen=!1,t.isChanged=!1,t.name.subscribe(function(e){t.isChanged=!0}),t.quantity.subscribe(function(e){t.isChanged=!0}),t.buyPrice.subscribe(function(e){t.isChanged=!0}),t.sellPrice.subscribe(function(e){t.isChanged=!0})},s=function(e,t){var s=this;s._id=r.observable(e?e._id:""),s.client=r.observable(e?e.client:""),s.postage=r.observable(e&&e.postage?e.postage:0);var a=[];if(e&&n.isArray(e.items)&&e.items.length>0)e.items.forEach(function(e){a.push(new i(e))});else for(var o=0;o<3;o++)a.push(new i);s.isChanged=!1,s.items=r.observableArray(a),s.items.subscribe(function(e){s.isChanged=!0}),s.client.subscribe(function(e){s.isChanged=!0}),s.postage.subscribe(function(e){s.isChanged=!0}),s.createDate=r.observable(e?e.createDate:""),s.displayDate=r.observable(e?e.displayDate:""),s.rate=e?e.rate:"",s.buyPrice=r.observable(e&&e.buyPrice?e.buyPrice:""),s.sellPrice=r.observable(e&&e.sellPrice?e.sellPrice:""),s.profit=r.observable(e&&e.profit?e.profit:""),s.isComplete=r.observable(!(!e||!e.isComplete)&&e.isComplete),s.formatPrice=function(e){if(!e)return"?";var t=e();return t?(+t).toFixed(1):"?"},s.total=r.pureComputed(function(){var e=parseFloat(this.sellPrice()),t=parseFloat(this.postage());return isNaN(e)||isNaN(t)?"?":(e+t).toFixed(1)},s);s.status=r.observable(e?e.status:"1RECEIVED"),s.packingStatus=e?e.packingStatus:"1ISREADY",s.orderStatus=r.pureComputed(function(){return"3DONE"==s.status()?"font-green":"2SENT"==s.status()?"font-yellow":void 0}),s.getHistoricTrades=function(e,i,s){var a=r.mapping.toJS(e),o=n(s.target).closest(".item").find(".historicbox");if(e.isHistoricTradesOpen)o.slideUp("fast",function(){e.isHistoricTradesOpen=!1,t.update()});else{var c=arguments[4];if(""==a.name)return;arguments[3](),n.getJSON("./historictrades",{itemName:a.name},function(t,n){"success"==n?e.historicTrades(t):e.historicTrades([]),o.slideDown("fast",function(){e.isHistoricTradesOpen=!0,c()})})}},s.hasHistoricTrades=function(e){return e.historicTrades().length>0},s.addItem=function(){s.items.unshift(new i),t.update()},s.removeItem=function(e){s.items.remove(e),t.update()},s.addClient=function(e){var n;s.clients.unshift((n={_id:"",client:s.client(),recipient:""},_defineProperty(n,"client",""),_defineProperty(n,"phone",""),n)),t.update()},s.getClients=function(e){arguments[3]();var t=arguments[4],r=e.client();""!=r&&n.getJSON("./clientsByClient",{client:r},function(n,r){"success"==r?e.clients(n):e.clients([]),t()})};var c=[];s.removeClient=function(e){""!=e._id&&c.push(e._id),s.clients.remove(e),t.update()},s.submitClients=function(e){arguments[3]();var t=arguments[4],i=r.mapping.toJS(e.clients);return n.post("./clients",{client:e.client,clients:i},function(n,r){e.clients(n),t()},"json"),!1},s.submitOrder=function(e){arguments[3]();var t=(arguments[4],n.parseJSON(r.toJSON(e)));return n.post("./order",t,function(t,n){t.items.forEach(function(e){e.historicTrades=[]}),console.log("get post result"),r.mapping.fromJS(t,{},e)},"json"),!1}};return function(e,a){function o(e){var t=l.filter(function(t){return t.client().indexOf(e)>=0});u.orders(t),setTimeout(function(){a.update()},100)}function c(e){g=e;var t=setTimeout(function(){for(var e=1;e<m.length;e++)clearTimeout(m[e]);m=[],""!=g&&n.ajax("./ordersByName",{data:{client:g},type:"GET",success:function(e,t){u.orders(u.getObservableOrders(e)),setTimeout(function(){a.update()},100)},dataType:"json"}),console.log("i am searching "+g)},1e3);m.push(t)}var u=this,d=t();u.updateReservedOrders=function(e){l=e},u.sortOrders=function(e){e.sort(function(e,t){var n=e.status(),r=t.status();return n==r?e.createDate()<=t.createDate()?1:-1:n<r?-1:1})},u.getObservableOrders=function(e){var t=[];return e.forEach(function(e){t.push(new s(e,a))}),t};var f=u.getObservableOrders(e);u.orders=r.observableArray(f),u.toggleClientView=function(e,t,r){n(r.target).toggleClass("icon-eyeslash");var i=n(".orders--reckoning");n(r.target).hasClass("icon-eyeslash")?i.addClass("isClientView"):i.removeClass("isClientView"),a.update()},u.markDone=function(e){arguments[3]();var t=arguments[4],r=(arguments[1],e._id()),i=e.status(),s="1RECEIVED";"1RECEIVED"==i?s="2SENT":"2SENT"==i&&(s="3DONE"),n.ajax("./orderStatus/"+r,{success:function(r,i){e.status(s);var a=u.orders();""==n("#search-reckoningOrders").val()?("3DONE"==s&&e.createDate()<d&&u.removeDoneOrder(e),u.sortOrders(a),u.orders(a),u.updateReservedOrders(a)):p=!0,t()},data:{status:s},dataType:"json",type:"PUT"})},u.submitOrders=function(){arguments[3]();var e=arguments[4],t=u.orders(),s=n.parseJSON(r.toJSON(t));if(Array.isArray(s)&&s.length>0){var a=[],o=s.filter(function(e,t){var n=!1;if(e.isChanged)n=!0;else for(var r=0;r<e.items.length;r++)if(e.items[r].isChanged){n=!0;break}return n&&a.push(t),n});o.length>0?n.post("./orders",{orders:o},function(s,o){s.forEach(function(e,s){var o=a[s];n.isArray(e.items)&&0==e.items.length&&(e.items=[{},{},{}]),e.items.forEach(function(e){e.historicTrades=[]}),r.mapping.fromJS(e,{items:{create:function(e){return new i(e.data)}}},t[o]),t[o].isChanged=!1}),e()},"json"):e()}return""!=n("#search-reckoningOrders").val()&&(p=!0),!1},u.afterRender=function(){a.update()},u.addOrder=function(){var e=new s(null,a);u.orders.unshift(e),u.updateReservedOrders(u.orders()),a.update(),n(window).scrollTop(0)},u.addExistingOrder=function(e){u.orders.push(doneOrder)},u.removeDoneOrder=function(e){u.orders.remove(e)},u.removeOrder=function(e){arguments[3]();var t=arguments[4],r=e._id();if(u.orders.remove(e),""==r)return void t();n.ajax("./order/"+r,{success:function(e,n){t()},dataType:"json",type:"DELETE"}),u.updateReservedOrders(u.orders()),a.update()};var l=null,p=!1;u.searchOrders=function(e,t){var r=n(t.target).val(),i=r.match(/(\s*)([\u4E00-\u9FA5\uF900-\uFA2D\w]+[\u4E00-\u9FA5\uF900-\uFA2D\w ]*)/);null==l&&(l=u.orders()),null!=i?""==i[1]?o(i[2]):c(i[2]):p?n.getJSON("./reckoningOrdersJson",function(e,t){var n=u.getObservableOrders(e);l=n,p=!1,u.orders(n),setTimeout(function(){a.update()},100)}):null!=l&&(g="",u.sortOrders(l),u.orders(l),setTimeout(function(){a.update()},100))};var m=[],g=""}}),define("IncomeList",["common"],function(e){var t=e.$,n=e.ko;return n.mapping=e.mapping,function(e,r){var r=r,i=this;i.incomeList=n.observableArray(e),i.setIncomeList=function(e){i.incomeList(e)},i.formatPrice=function(e){return e?(+e).toFixed(1):"?"},i.toggleTotalView=function(e,n,r){t(r.target).toggleClass("icon-eyeopen");var i=t(r.target).closest(".orderitem-cnt");t(r.target).hasClass("icon-eyeopen")?i.addClass("isShow"):i.removeClass("isShow")},i.afterRender=function(){r.update()}}}),define("ClientsModel",["common"],function(e){var t=e.$,n=e.ko;n.mapping=e.mapping;var r=function(e){var t=this;t.recipient=n.observable(e?e.recipient:""),t.address=n.observable(e?e.address:""),t.phone=n.observable(e?e.phone:""),t.isActive=n.observable(!(!e||!e.isActive)),t.defaultAddressCss=n.pureComputed(function(){return t.isActive()?"icon-radio-selected":"icon-radio"}),t.isChanged=!1,t.recipient.subscribe(function(e){t.isChanged=!0}),t.address.subscribe(function(e){t.isChanged=!0}),t.phone.subscribe(function(e){t.isChanged=!0}),t.isActive.subscribe(function(e){t.isChanged=!0})},i=function(e,t){var i=this;i._id=n.observable(e?e._id:""),i.name=n.observable(e?e.name:""),i.createDate=e&&e.createDate?e.createDate:"",i.isActive=n.observable(!(!e||!e.isActive)),e&&Array.isArray(e.addresses)&&e.addresses.length>0?i.addresses=n.observableArray(e.addresses.map(function(e){return new r(e)})):i.addresses=n.observableArray([new r]),i.isChanged=!1,i.name.subscribe(function(e){i.isChanged=!0}),i.addresses.subscribe(function(e){i.isChanged=!0}),i.addAddress=function(){i.addresses.unshift(new r),t.update()},i.removeAddress=function(e){i.addresses.remove(e),t.update()},i.markDefault=function(e,t){t.addresses().forEach(function(e){return e.isActive(!1)}),e.isActive(!0)}};return function(e,s){function a(){var e=u.clients(),t=e.filter(function(e){var t=e.name();return e.isActive()&&t.indexOf("?")==-1&&t.indexOf("？")==-1}),n=t.filter(function(e){var t=e.name();return t.indexOf("-")>=0||t.indexOf("－")>=0}),r=[];n.forEach(function(e){var t=e.name(),n=t.indexOf("-"),i=t.indexOf("－"),s=-1;s=n>-1&&i>-1?Math.min(n,i):n>-1?n:i;var a=t.slice(0,s);r.find(function(e){return e==a})||r.push(a)});var i=[];r.forEach(function(e){var t=n.filter(function(t){return t.name().startsWith(e)}),r=o(e,t);i.push(r)});var s=t.filter(function(e){var t=e.name();return t.indexOf("-")==-1||t.indexOf("－")==-1}),a=o("自己的",s);return i.push(a),i}function o(e,t){var n="";return t.forEach(function(e){var t=e.addresses().find(function(e){return e.isActive()}),r=t.recipient(),i=t.phone(),s=t.address();""!=r&&""!=i&&""!=s&&(n+=t.recipient()+"，"+t.phone()+"，"+t.address()+"；")}),{name:e+"：",receives:n}}function c(e){var t=[];return e.forEach(function(e){t.push(new i(e,s))}),t}var u=this,d=c(e);u.clients=n.observableArray(d),u.setClients=function(e){u.clients(c(e)),u.senders(a())},u.senders=n.observableArray(a()),u.setSenders=function(){u.senders(a())},u.addClient=function(){u.clients.unshift(new i(null,s)),s.update()},u.removeClient=function(e){arguments[3]();var n=arguments[4],r=e._id();if(u.clients.remove(e),""==r)return s.update(),void n();t.ajax("./client/"+r,{success:function(e,t){n()},dataType:"json",type:"DELETE"}),s.update()},u.submitClients=function(e){arguments[3]();var i=arguments[4],s=u.clients();if(Array.isArray(s)&&s.length>0){var a=[],o=s.filter(function(e,t){var n=!1;if(""!=e.name)if(e.isChanged)n=!0;else{var r=e.addresses(),i=r.find(function(e){return e.isChanged});i&&(n=!0)}return n&&a.push(t),n});if(o.length>0){var c=t.parseJSON(n.toJSON(o));t.post("./clients",{clients:c},function(e,o){e.forEach(function(e,i){var o=a[i];t.isArray(e.addresses)&&0==e.addresses.length&&(e.addresses=[{}]),n.mapping.fromJS(e,{addresses:{create:function(e){return new r(e.data)}}},s[o]),s[o].isChanged=!1}),u.setSenders(),i()},"json")}else i()}return!1}}}),define("../js/main",["common","ReceivedOrders","ItemsModel","ReckoningOrders","IncomeList","ClientsModel"],function(e,t){function n(){function n(e){switch(s(".swiper-slide")[e].id){case"receivedOrders":c.purchaseItems=!0,c.reckoningOrders=!0;break;case"purchaseItems":c.receivedOrders=!0,c.reckoningOrders=!0;break;case"reckoningOrders":c.receivedOrders=!0,c.purchaseItems=!0,c.incomeList=!0,c.clients=!0}}function r(){var e=s(".swiper-slide")[u.activeIndex].id;"receivedOrders"==e&&s.getJSON("./receivedOrdersJson",function(e,t){m.setOrders(e,!0)}),"reckoningOrders"==e&&s.getJSON("./reckoningOrdersJson",function(e,t){var n=f.getObservableOrders(e);f.orders(n)})}function i(){var e=s(".swiper-slide")[u.activeIndex].id;"incomeList"!=e&&"reckoningOrders"!=e||s.getJSON("./receivedOrdersJson",function(e,t){m.setOrders(e,!0)}),"receivedOrders"!=e&&"reckoningOrders"!=e||s.getJSON("./purchaseItemsJson",function(e,t){d.setItems(e.items,!0,!0)}),"receivedOrders"!=e&&"incomeList"!=e||s.getJSON("./reckoningOrdersJson",function(e,t){var n=f.getObservableOrders(e);f.orders(n)}),"reckoningOrders"==e&&s.getJSON("./incomeListJson",function(e,t){l.setIncomeList(e)}),"reckoningOrders"==e&&s.getJSON("./clientsJson",function(e,t){p.setClients(e)})}var s=e.$,a=e.ko,o=(e.mapping,e.Swiper),c={receivedOrders:!1,purchaseItems:!1,reckoningOrders:!1,incomeList:!1,clients:!1},u=new o(".swiper-container",{autoHeight:!0,spaceBetween:30,pagination:".swiper-pagination",paginationClickable:!0,simulateTouch:!1,shortSwipes:!1,longSwipes:!1,paginationBulletRender:function(e,t){var n="";switch(s(".swiper-slide")[e].id){case"receivedOrders":n="接单";break;case"purchaseItems":n="采购";break;case"reckoningOrders":n="算账";break;case"incomeList":n="收益";break;case"clients":n="客户"}return'<span class="'+t+'">'+n+"</span>"}});e.initTapEvent({updateAllData:i,updateCurrentData:r,setViewModelStatus:n,swiper:u});var d,f,l,p,m=new t(orders);m.setSwiper(u),a.applyBindings(m,s("#receivedOrders")[0]),require(["common","ItemsModel","ReckoningOrders","IncomeList","ClientsModel"],function(e,t,r,i,s){var a=e.$,o=e.ko,g=new Promise(function(e,r){a.getJSON("./purchaseItemsJson",function(r,i){d=new t(r.items,u),e(d),o.applyBindings(d,a("#purchaseItems")[0]);var s=new Promise(function(e,t){a.getJSON("./user/"+USER_ID,function(t,n){e(t)})});s.catch(function(e){}),s.then(function(e){var t=Array.isArray(e.tags)?e.tags:[];a(".hidden-tag").tag({tags:t,updateTag:function(e,t,r){if(t!=r){if(Array.isArray(d.allItems)&&d.allItems.length>0){var i=d.allItems.find(function(t){return t._id==e});if(i.tag=r,i){var s=[];d.allItems.forEach(function(e){s.indexOf(e.tag)<0&&e.tag&&s.push(e.tag)}),d.tags(s)}}a.post("./itemtag",{itemName:e,oldTag:t,newTag:r},function(e,t){n(u.activeIndex)},"json")}}})})})}),v=new Promise(function(e,t){a.getJSON("./reckoningOrdersJson",function(t,n){f=new r(t,u),e(f),o.applyBindings(f,a("#reckoningOrders")[0])})});Promise.all([g,v]).then(function(e){}),a.getJSON("./incomeListJson",function(e,t){l=new i(e,u),o.applyBindings(l,a("#incomeList")[0])}),access.clients&&a.getJSON("./clientsJson",function(e,t){p=new s(e,u),o.applyBindings(p,a("#clients")[0])}),a(document).on("keydown",function(e){var t=a(".swiper-slide")[u.activeIndex].id;if(13==e.keyCode){a(document.activeElement).blur();var n=a("#"+t+" .action-enter");return setTimeout(function(){n.trigger("click")},100),!1}}),u.params.onSlideChangeStart=function(e){switch(a(".swiper-slide")[e.activeIndex].id){case"receivedOrders":c.receivedOrders&&a.getJSON("./receivedOrdersJson",function(e,t){m.setOrders(e,!0),c.receivedOrders=!1});break;case"purchaseItems":c.purchaseItems&&a.getJSON("./purchaseItemsJson",function(e,t){d.setItems(e.items,!0,!0),c.purchaseItems=!1});break;case"reckoningOrders":c.reckoningOrders&&a.getJSON("./reckoningOrdersJson",function(e,t){var n=f.getObservableOrders(e);f.orders(n),c.reckoningOrders=!1});break;case"incomeList":c.incomeList&&a.getJSON("./incomeListJson",function(e,t){l.setIncomeList(e),c.incomeList=!1});break;case"clients":c.clients&&a.getJSON("./clientsJson",function(e,t){p.setClients(e),c.clients=!1})}setTimeout(function(){a(window).scrollTop(0)},100)}}),require(["angularApp"],function(e){e().bootstrap(s("#settings")[0],["settings"]),s(".icon-cog").colorbox({inline:!0,width:335,height:200,scrolling:!1,close:"",top:0,onComplete:function(){setInterval(function(){s.colorbox.resize()},200)}}),s(window).scroll(function(){var e=s(window).scrollTop();s(".searchbox").css("top",e)})}),s(".icon-signout").bind("click",function(){return s(".mask").addClass("isLoginShow"),s.get("./logout",function(e,t){e.success&&s.get("./content",function(e,t){setTimeout(function(){s("#container").html(e),s(".mask").removeClass("isLoginShow")},1e3)},"html")},"json"),!1})}return n});