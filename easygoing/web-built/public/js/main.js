"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("ReceivedOrders",["common"],function(e){var t=e.$,n=e.ko;n.mapping=e.mapping;var i=function(e){var i=this;i.name=n.observable(e&&e.name?e.name:""),i.quantity=n.observable(e&&e.quantity?e.quantity:"1"),i.note=n.observable(e&&e.note?e.note:""),i.buyPrice=e&&!isNaN(e.buyPrice)?e.buyPrice:"",i.sellPrice=e&&!isNaN(e.sellPrice)?e.sellPrice:"",i.profit=e&&e.profit?e.profit:"",i.isDone=!(!e||void 0===e.isDone)&&e.isDone,i.tag=e&&e.tag?e.tag:"",i.isLiveSearch=!1,i.bindLiveSearch=function(e,n){i.isLiveSearch||(i.isLiveSearch=!0,t(n.target).dropdown({itemType:"product",trigger:!0}))},i.isChanged=!1,i.name.subscribe(function(e){i.isChanged=!0}),i.quantity.subscribe(function(e){i.isChanged=!0}),i.note.subscribe(function(e){i.isChanged=!0})},r=function(e,r){var s=this;s._id=n.observable(e&&e._id?e._id:""),s.client=n.observable(e&&e.client?e.client:""),s.packingStatus=n.observable(e&&e.packingStatus?e.packingStatus:"1ISREADY"),s.rate=e&&e.rate?e.rate:null,s.postage=e&&e.postage?e.postage:0,s.buyPrice=e&&e.buyPrice?e.buyPrice:"",s.sellPrice=e&&e.sellPrice?e.sellPrice:"",s.profit=e&&e.profit?e.profit:"",s.status=e&&e.status?e.status:"1RECEIVED",s.createDate=e&&e.createDate?e.createDate:"",s.isLiveSearch=!1,s.bindLiveSearch=function(e,n){s.isLiveSearch||(s.isLiveSearch=!0,t(n.target).dropdown({itemType:"client",trigger:!0}))};var o={month:"2-digit",day:"numeric",weekday:"short"};s.displayDate=s.createDate?new Date(s.createDate).toLocaleDateString("en-US",o):"";var a=[];if(e&&t.isArray(e.items)&&e.items.length>0)e.items.forEach(function(e){a.push(new i(e))});else for(var c=0;c<3;c++)a.push(new i);s.items=n.observableArray(a),s.isChanged=!1,s.client.subscribe(function(e){s.isChanged=!0}),s.items.subscribe(function(e){s.isChanged=!0}),s.addItem=function(){s.items.unshift(new i),r.update()},s.removeItem=function(e){s.items.remove(e),r.update()},s.orderPackingStatus=n.pureComputed(function(){return"3PACKED"==s.packingStatus()?"font-green":"2NOTREADY"==s.packingStatus()?"font-yellow":"font-black"}),s.orderReadyStatus=n.pureComputed(function(){return"2NOTREADY"==s.packingStatus()?"icon-thumbsdown font-yellow":"icon-thumbsup font-black"})};return function(e,s){function o(e){var t=[];if(Array.isArray(e)&&e.length>0)e.forEach(function(e){t.push(new r(e,u))});else for(var n=0;n<30;n++)t.push(new r(null,u));return t}function a(e){e.sort(function(e,t){var n=e.packingStatus(),i=t.packingStatus();return n==i?e.createDate<=t.createDate?1:-1:n<i?-1:1})}function c(){setTimeout(function(){u.update()},100)}var u=s,l=!1,d=null,f=this;f.setSwiper=function(e){u=e,c()},f.orders=n.observableArray(o(e)),f.setOrders=function(e,t){l=!0,f.searchOrders(),c()},f.submitOrder=function(e){arguments[3]();var i=arguments[4];console.log("post request....");var r=n.mapping.toJS(e);return t.post("./order",r,function(t,r){console.log("get post result"),n.mapping.fromJS(t,{},e),i()},"json"),!1},f.submitOrders=function(){arguments[3]();var e=arguments[4],r=f.orders(),s=t.parseJSON(n.toJSON(r));if(Array.isArray(s)&&s.length>0){var o=[],a=s.filter(function(e,t){var n=!1;if(""!=e.client)if(e.isChanged)n=!0;else for(var i=0;i<e.items.length;i++)if(e.items[i].isChanged){n=!0;break}return n&&o.push(t),n});a.length>0?t.post("./orders",{orders:a},function(s,a){s.forEach(function(e,s){var a=o[s];t.isArray(e.items)&&0==e.items.length&&(e.items=[{},{},{}]),n.mapping.fromJS(e,{items:{create:function(e){return new i(e.data)}}},r[a]),r[a].isChanged=!1}),l=!0,e()},"json"):e()}return!1},f.markPackingStatus=function(e){var n=t(arguments[2].target),i=e.packingStatus();if(!n.hasClass("icon-leaf")||"2NOTREADY"!=i){arguments[3]();var r=arguments[4],s=(arguments[1],e._id()),o="";if(n.hasClass("icon-leaf")?"1ISREADY"==i?o="3PACKED":"3PACKED"==i&&(o="1ISREADY"):o="1ISREADY"==i||"3PACKED"==i?"2NOTREADY":"1ISREADY",""==o)return void r();t.ajax("./packingStatus/"+s,{success:function(t,n){e.packingStatus(o);var i=f.orders();a(i),f.orders(i),l=!0,r()},data:{packingStatus:o},dataType:"json",type:"PUT"})}},f.addOrder=function(){var e=new r(null,u);f.orders.unshift(e),d.unshift(e),c(),t(window).scrollTop(0)},f.removeOrder=function(e){arguments[3]();var n=arguments[4],i=e._id();if(f.orders.remove(e),""==i)return void n();t.ajax("./order/"+i,{success:function(e,t){l=!0,n()},dataType:"json",type:"DELETE"}),c()},f.refreshOrders=function(){return l?new Promise(function(e,n){t.getJSON("./receivedOrdersJson",function(t,n){l=!1,e(o(t))})}):Promise.resolve(d?d:f.orders())},f.searchOrders=function(e,n){var i=t("#search-receivedOrders").val();f.refreshOrders().then(function(e){d=e;var t=d;""!=i&&(t=d.filter(function(e){return e.client().indexOf(i)>=0})),a(t),f.orders(t),c()})},f.afterRender=function(){c(),t(".mask").removeClass("isShow")},f.afterOrderRender=function(){t("#receivedOrdersBody").children().length===f.orders().length&&c()}}}),define("ItemsModel",["common"],function(e){var t=e.$,n=e.ko;n.mapping=e.mapping;var i=function(e){var t=this;t._id=e._id,t.client=e.client,t.name=e.name,t.note=e.note,t.quantity=e.quantity,t.isDone=n.observable(e.isDone)},r=function(e,r){function s(e){var t=e.findIndex(function(e){return e._id==o._id&&e.tag==o.tag()});t>-1&&(e[t]=n.mapping.toJS(o))}var o=this;o._id=e&&e._id?e._id:"",o.quantity=e?e.quantity:"",o.tag=n.observable(e&&e.tag?e.tag:""),o.purchaseDetail=n.observableArray(e?e.purchaseDetail:[]),o.getEmptyCss=function(){if(!o.tag())return"isEmpty"},o.subItems=n.observableArray([]),o.updateSubItems=function(e){var t=[];Array.isArray(e)&&e.length>0&&e.forEach(function(e){t.push(new i(e))}),o.subItems(t)},o.hasItemDetail=function(e){return o.subItems().length>0},o.restCount=n.pureComputed(function(){var e=o.purchaseDetail(),t=0,n=0;return e.forEach(function(e){e.isDone?t=e.quantity:n=e.quantity}),t<o.quantity&&0!=t?o.quantity-t:""}),o.displaySubItems=n.pureComputed(function(){return o.subItems().length>0}),o.isLiveSearch=!1,o.bindLiveSearch=function(){o.isLiveSearch||(o.isLiveSearch=!0,t(arguments[2].target).tag({itemName:o._id,trigger:!0}))},o.markDone=function(e,i,r){arguments[3]();var a=arguments[4],c=n.mapping.toJS(e),u=!0;c.purchaseDetail.forEach(function(e){e.isDone||(u=!1)}),t.post("./item",{itemTag:c.tag,itemName:c._id,isDone:!u},function(t,n){e.purchaseDetail(t.purchaseDetail),s(i.allItems);o.displaySubItems&&o.subItems().forEach(function(e){e.isDone(!u)}),a()},"json")},o.markItemStatus=function(){var e=o.purchaseDetail(),t=0,n=0;return e.forEach(function(e){e.isDone?t=e.quantity:n=e.quantity}),n==o.quantity?"":t==o.quantity?"font-green":"font-yellow"},o.markSubItemDone=function(e,i,r){arguments[3]();var a=arguments[4],c=arguments[5],u=n.mapping.toJS(e);u.isDone=!u.isDone,u.tag=i.tag(),t.post("./subitem",u,function(t,n){e.isDone(!e.isDone()),o.purchaseDetail(t.purchaseDetail),s(c.allItems),o.subItems().forEach(function(t){t.client==e.client&&t.isDone(e.isDone())}),a()},"json")},o.getSubName=function(e){return"item"+e.isDone},o.getSubItems=function(e,i,s){var a=n.mapping.toJS(e);if(e.isSubItemsOpen())t(s.target).parents(".orderitem-cnt").next().slideUp("fast",function(){e.isSubItemsOpen(!1),r.update()});else{arguments[3]();var c=arguments[4];t.getJSON("./subitems",{itemName:a._id,itemTag:a.tag},function(n,i){"success"==i?o.updateSubItems(n):e.subItems([]),t(s.target).parents(".orderitem-cnt").next().slideDown("fast",function(){e.isSubItemsOpen(!0),c()})})}},o.getExpandCollapse=function(){return o.isSubItemsOpen()?"icon-collapse":"icon-expand"},o.isSubItemsOpen=n.observable(!1)};return function(e,i){function s(e){var t="function"==typeof e.purchaseDetail?e.purchaseDetail():e.purchaseDetail,n=0,i=0;return t.forEach(function(e){e.isDone?n=e.quantity:i=e.quantity}),i==e.quantity?-1:n==e.quantity?1:0}function o(e,t){if(e.tag<t.tag)return-1;if(e.tag>t.tag)return 1;var n=s(e),i=s(t);if(n<i)return-1;if(n>i)return 1;var r=e._id.substr(0,1),o=t._id.substr(0,1);return r<o?-1:r>o?1:0}function a(e,t){var n=s(e),i=s(t);if(n<i)return-1;if(n>i)return 1;if(e.tag<t.tag)return-1;if(e.tag>t.tag)return 1;var r=e._id.substr(0,1),o=t._id.substr(0,1);return r<o?-1:r>o?1:0}function c(e,t,n){var s=[],c=[];return Array.isArray(e)&&e.length>0&&("status"==n?e.sort(a):e.sort(o),e.forEach(function(e){s.push(new r(e,i)),t&&c.indexOf(e.tag)<0&&e.tag&&c.push(e.tag)})),[s,c]}var u=this;u.allItems=[],u.tags=n.observableArray(),u.items=n.observableArray(),u.setItems=function(e,r,s){var o=!1;r&&(t(".link-tag.all").addClass("isActive"),o=!0);var a=c(e,o),l=_slicedToArray(a,2),e=l[0],d=l[1];u.items(e),r&&(u.tags(d),u.allItems=u.items().map(function(e){return n.mapping.toJS(e)})),setTimeout(function(){i.update()},100)},u.setItems(e,!0,!1),u.refreshItems=function(e){var i=u.items().map(function(e){return n.mapping.toJS(e)}),r=t(".link-tag.isActive");r.hasClass("all")||(i=i.filter(function(e){return e.tag==r.text()}));var s=c(i,!1,e),o=_slicedToArray(s,2),a=o[0];o[1];u.items(a)},u.filterItems=function(e,n,r){var s=t(r.target);if(t(".link-tag.isActive").removeClass("isActive"),s.addClass("isActive"),s.hasClass("all"))u.setItems(u.allItems,!0,!0);else{var o=u.allItems.filter(function(t){return t.tag==e});u.setItems(o,!1,!0)}i.update(),t(document).click()},u.afterRender=function(){i.update()}}}),define("ReckoningOrders",["common"],function(e){function t(){var e=Date.now(),t=(new Date).getDay(),n=e-24*(t+7)*60*60*1e3;return new Date(new Date(n).setHours(0,0,0,0))}var n=e.$,i=e.ko;i.mapping=e.mapping;var r=function(e){function t(e){var t=e;return"string"==typeof t&&t.startsWith("?")&&(t=t.slice(1),r.isChanged=!0),t}var r=this;r.name=i.observable(e&&e.name?e.name:""),r.quantity=i.observable(e&&e.quantity?e.quantity:"1"),r.buyPrice=i.observable(e&&e.buyPrice?t(e.buyPrice):""),r.sellPrice=i.observable(e&&e.sellPrice?t(e.sellPrice):""),r.profit=e&&e.profit?e.profit:"",r.note=e&&e.note?e.note:"",r.isDone=!(!e||!e.isDone)&&e.isDone,r.tag=e&&e.tag?e.tag:"",r.historicTrades=i.observableArray([]),r.isDoubtSellPrice=i.observable(e&&e.isDoubtSellPrice||!1),r.isDoubtBuyPrice=i.observable(e&&e.isDoubtBuyPrice||!1),r.isLiveSearch=!1,r.bindLiveSearch=function(e,t){r.isLiveSearch||(r.isLiveSearch=!0,n(t.target).dropdown({itemType:"product",trigger:!0,afterChosen:function(e){var t=e.sellPrice,n=void 0===t?"":t,i=e.buyPrice,s=void 0===i?"":i;(r.isDoubtSellPrice()||""==r.sellPrice())&&(r.sellPrice(n),r.isDoubtSellPrice(!0)),(r.isDoubtBuyPrice()||""==r.buyPrice())&&(r.buyPrice(s),r.isDoubtBuyPrice(!0))}}))},r.isHistoricTradesOpen=!1,r.isChanged=!1,r.name.subscribe(function(e){r.isChanged=!0}),r.quantity.subscribe(function(e){r.isChanged=!0}),r.buyPrice.subscribe(function(e){r.isChanged=!0}),r.sellPrice.subscribe(function(e){r.isChanged=!0})},s=function(e,t){var s=this;s._id=i.observable(e?e._id:""),s.client=i.observable(e?e.client:""),s.postage=i.observable(e&&e.postage?e.postage:0);var o=[];if(e&&n.isArray(e.items)&&e.items.length>0)e.items.forEach(function(e){o.push(new r(e))});else for(var a=0;a<3;a++)o.push(new r);s.isChanged=e&&e.isChanged,s.items=i.observableArray(o),s.items.subscribe(function(e){s.isChanged=!0}),s.client.subscribe(function(e){s.isChanged=!0}),s.postage.subscribe(function(e){s.isChanged=!0}),s.createDate=i.observable(e?e.createDate:""),s.displayDate=i.observable(e?e.displayDate:""),s.rate=e?e.rate:"",s.buyPrice=i.observable(e&&e.buyPrice?e.buyPrice:""),s.sellPrice=i.observable(e&&e.sellPrice?e.sellPrice:""),s.profit=i.observable(e&&e.profit?e.profit:""),s.isComplete=i.observable(!(!e||!e.isComplete)&&e.isComplete),s.isLiveSearch=!1,s.bindLiveSearch=function(e,t){s.isLiveSearch||(s.isLiveSearch=!0,n(t.target).dropdown({itemType:"client",trigger:!0}))},s.formatPrice=function(e){if(!e)return"?";var t=e();return t?(+t).toFixed(1):"?"},s.total=i.pureComputed(function(){var e=parseFloat(this.sellPrice()),t=parseFloat(this.postage());return isNaN(e)||isNaN(t)?"?":(e+t).toFixed(1)},s);s.status=i.observable(e?e.status:"1RECEIVED"),s.packingStatus=e?e.packingStatus:"1ISREADY",s.orderStatus=i.pureComputed(function(){return"3DONE"==s.status()?"font-green":"2SENT"==s.status()?"font-yellow":"3PACKED"!=s.packingStatus?"font-grey":void 0}),s.getHistoricTrades=function(e,r,s){var o=i.mapping.toJS(e),a=n(s.target).closest(".itembox--reckoning").find(".historicbox");if(e.isHistoricTradesOpen)a.slideUp("fast",function(){e.isHistoricTradesOpen=!1,t.update()});else{var c=arguments[4];if(""==o.name)return;arguments[3](),n.getJSON("./historictrades",{itemName:o.name},function(t,n){"success"==n?e.historicTrades(t):e.historicTrades([]),a.slideDown("fast",function(){e.isHistoricTradesOpen=!0,c()})})}},s.hasHistoricTrades=function(e){return e.historicTrades().length>0},s.addItem=function(){s.items.unshift(new r),t.update()},s.removeItem=function(e){s.items.remove(e),t.update()},s.addClient=function(e){var n;s.clients.unshift((n={_id:"",client:s.client(),recipient:""},_defineProperty(n,"client",""),_defineProperty(n,"phone",""),n)),t.update()},s.getClients=function(e){arguments[3]();var t=arguments[4],i=e.client();""!=i&&n.getJSON("./clientsByClient",{client:i},function(n,i){"success"==i?e.clients(n):e.clients([]),t()})};var c=[];s.removeClient=function(e){""!=e._id&&c.push(e._id),s.clients.remove(e),t.update()},s.submitClients=function(e){arguments[3]();var t=arguments[4],r=i.mapping.toJS(e.clients);return n.post("./clients",{client:e.client,clients:r},function(n,i){e.clients(n),t()},"json"),!1},s.submitOrder=function(e){arguments[3]();var t=(arguments[4],n.parseJSON(i.toJSON(e)));return n.post("./order",t,function(t,n){t.items.forEach(function(e){e.historicTrades=[]}),console.log("get post result"),i.mapping.fromJS(t,{},e)},"json"),!1}};return function(e,o){function a(){setTimeout(function(){o.update()},100)}function c(e){var t="";"b"==h?t="1RECEIVED":"y"==h?t="2SENT":"g"==h&&(t="3DONE");var n=f.filter(function(e){var n=e.client().indexOf(g)>=0;return""!=t?n&&e.status()==t:n});e&&e(n),l.orders(n)}function u(e){var t=setTimeout(function(){for(var t=1;t<b.length;t++)clearTimeout(b[t]);if(b=[],""!=g){var i="";"b"==h?i="1RECEIVED":"y"==h?i="2SENT":"g"==h&&(i="3DONE");var r={client:g};""!=i&&(r.status=i),n.ajax("./ordersByName",{data:r,type:"GET",success:function(t,n){if(!/^\s?$/.test(g)){var i=l.init(t);e&&e(i),l.orders(i)}},dataType:"json"}),console.log("i am searching "+g)}},1e3);b.push(t)}var l=this,d=t();l.sortOrders=function(e){e.sort(function(e,t){var n=e.status(),i=t.status();return n==i?e.createDate()<=t.createDate()?1:-1:n<i?-1:1})},l.init=function(e){var t=[];return e.forEach(function(e){t.push(new s(e,o))}),t},l.orders=i.observableArray(l.init(e)),l.setOrders=function(e){p=!0,l.searchOrders(null,null,e),a()},l.refreshOrders=function(){return p?new Promise(function(e,t){n.getJSON("./reckoningOrdersJson",function(t,n){p=!1,e(l.init(t))})}):Promise.resolve(f?f:l.orders())},l.toggleClientView=function(e,t,i){n(i.target).toggleClass("icon-eyeslash");var r=n(".orders--reckoning");n(i.target).hasClass("icon-eyeslash")?r.addClass("isClientView"):r.removeClass("isClientView"),o.update()},l.markDone=function(e){arguments[3]();var t=arguments[4],i=(arguments[1],e._id()),r=e.status(),s="1RECEIVED";"1RECEIVED"==r?s="2SENT":"2SENT"==r&&(s="3DONE"),n.ajax("./orderStatus/"+i,{success:function(n,i){e.status(s),"3DONE"==s&&e.createDate()<d&&l.removeDoneOrder(e);var r=l.orders();l.sortOrders(r),l.orders(r),p=!0,t()},data:{status:s},dataType:"json",type:"PUT"})},l.submitOrders=function(){arguments[3]();var e=arguments[4],t=l.orders(),s=n.parseJSON(i.toJSON(t));if(Array.isArray(s)&&s.length>0){var o=[],a=s.filter(function(e,t){var n=!1;if(e.isChanged)n=!0;else for(var i=0;i<e.items.length;i++)if(e.items[i].isChanged){n=!0;break}return n&&o.push(t),n});a.length>0?(a.forEach(function(e){e.____ko_mapping__=null}),n.post("./orders",{orders:a},function(s,a){s.forEach(function(e,s){var a=o[s];n.isArray(e.items)&&0==e.items.length&&(e.items=[{},{},{}]),e.items.forEach(function(e){e.historicTrades=[]}),i.mapping.fromJS(e,{items:{create:function(e){return new r(e.data)}}},t[a]),t[a].isChanged=!1}),p=!0,e()},"json")):e()}return!1},l.afterRender=function(){a(),n(".icon-question").colorbox({inline:!0,href:"#manual-search",width:335,height:200,scrolling:!1,close:"",top:0,onComplete:function(){setInterval(function(){n.colorbox.resize()},200)}})},l.afterOrderRender=function(){n("#reckoningOrdersBody").children().length===l.orders().length&&a()},l.addOrder=function(){var e=new s(null,o);l.orders.unshift(e),o.update(),n(window).scrollTop(0)},l.removeDoneOrder=function(e){l.orders.remove(e)},l.removeOrder=function(e){arguments[3]();var t=arguments[4],i=e._id();if(l.orders.remove(e),""==i)return void t();n.ajax("./order/"+i,{success:function(e,n){t()},dataType:"json",type:"DELETE"}),p=!0,o.update()};var f,p,m,g,v,h;l.searchOrders=function(e,t,i){var r=n("#search-reckoningOrders").val(),s=r.match(/(\s*)([\u4E00-\u9FA5\uF900-\uFA2D\w ]*)([\/\uff0f][bgy])?/);null!=s&&(m=!0,g=s[2],h=s[3]&&s[3].substr(1),l.refreshOrders().then(function(e){f=e,/^\s?$/.test(r)?(g="",m=!1,v=!1,l.sortOrders(f),i&&(f=i(f)),l.orders(f)):""==s[1]?c(i):u(i)}))};var b=[]}}),define("IncomeList",["common"],function(e){var t=e.$,n=e.ko;return n.mapping=e.mapping,function(e,i){var i=i,r=this;r.incomeList=n.observableArray(e),r.setIncomeList=function(e){r.incomeList(e)},r.formatPrice=function(e){return e?(+e).toFixed(1):"?"},r.toggleTotalView=function(e,n,i){t(i.target).toggleClass("icon-eyeopen");var r=t(i.target).closest(".orderitem-cnt");t(i.target).hasClass("icon-eyeopen")?r.addClass("isShow"):r.removeClass("isShow")},r.afterRender=function(){i.update()}}}),function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("clipboard",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Clipboard=e()}}(function(){var e;return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return r(n?n:e)},l,l.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){function i(e,t){for(;e&&e.nodeType!==r;){if(e.matches(t))return e;e=e.parentNode}}var r=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var s=Element.prototype;s.matches=s.matchesSelector||s.mozMatchesSelector||s.msMatchesSelector||s.oMatchesSelector||s.webkitMatchesSelector}t.exports=i},{}],2:[function(e,t,n){function i(e,t,n,i,s){var o=r.apply(this,arguments);return e.addEventListener(n,o,s),{destroy:function(){e.removeEventListener(n,o,s)}}}function r(e,t,n,i){return function(n){n.delegateTarget=s(n.target,t),n.delegateTarget&&i.call(e,n)}}var s=e("./closest");t.exports=i},{"./closest":1}],3:[function(e,t,n){n.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||n.node(e[0]))},n.string=function(e){return"string"==typeof e||e instanceof String},n.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},{}],4:[function(e,t,n){function i(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!a.string(t))throw new TypeError("Second argument must be a String");if(!a.fn(n))throw new TypeError("Third argument must be a Function");if(a.node(e))return r(e,t,n);if(a.nodeList(e))return s(e,t,n);if(a.string(e))return o(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function r(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function s(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function o(e,t,n){return c(document.body,e,t,n)}var a=e("./is"),c=e("delegate");t.exports=i},{"./is":3,delegate:2}],5:[function(e,t,n){function i(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var i=window.getSelection(),r=document.createRange();r.selectNodeContents(e),i.removeAllRanges(),i.addRange(r),t=i.toString()}return t}t.exports=i},{}],6:[function(e,t,n){function i(){}i.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function i(){r.off(e,i),t.apply(n,arguments)}var r=this;return i._=t,this.on(e,i,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;for(i;i<r;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var s=0,o=i.length;s<o;s++)i[s].fn!==t&&i[s].fn._!==t&&r.push(i[s]);return r.length?n[e]=r:delete n[e],this}},t.exports=i},{}],7:[function(t,n,i){!function(r,s){if("function"==typeof e&&e.amd)e(["module","select"],s);else if(void 0!==i)s(n,t("select"));else{var o={exports:{}};s(o,r.select),r.clipboardAction=o.exports}}(this,function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(e){return e&&e.__esModule?e:{default:e}}(t),r="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof2(e)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(t){n(this,e),this.resolveOptions(t),this.initSelection()}return s(e,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,i.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}();e.exports=o})},{select:5}],8:[function(t,n,i){!function(r,s){if("function"==typeof e&&e.amd)e(["module","./clipboard-action","tiny-emitter","good-listener"],s);else if(void 0!==i)s(n,t("./clipboard-action"),t("tiny-emitter"),t("good-listener"));else{var o={exports:{}};s(o,r.clipboardAction,r.tinyEmitter,r.goodListener),r.clipboard=o.exports}}(this,function(e,t,n,i){function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":_typeof2(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof2(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}var u=r(t),l=r(n),d=r(i),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),p=function(e){function t(e,n){s(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.resolveOptions(n),i.listenClick(e),i}return a(t,e),f(t,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText}},{key:"listenClick",value:function(e){var t=this;this.listener=(0,d.default)(e,"click",function(e){return t.onClick(e)})}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new u.default({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})}},{key:"defaultAction",value:function(e){return c("action",e)}},{key:"defaultTarget",value:function(e){var t=c("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return c("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach(function(e){n=n&&!!document.queryCommandSupported(e)}),n}}]),t}(l.default);e.exports=p})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)}),define("ClientsModel",["common","clipboard"],function(e,t){var n=e.$,i=e.ko;i.mapping=e.mapping;var r=function(e){var t=this;t.recipient=i.observable(e&&e.recipient?e.recipient:""),t.address=i.observable(e&&e.address?e.address:""),t.phone=i.observable(e&&e.phone?e.phone:""),t.isActive=i.observable(!(!e||!e.isActive)),t.defaultAddressMarkCss=i.pureComputed(function(){return t.isActive()?"icon-radio-selected":"icon-radio"}),t.defaultAddressCss=i.pureComputed(function(){return t.isActive()?"isActive":""}),t.isChanged=!1,t.recipient.subscribe(function(e){t.isChanged=!0}),t.address.subscribe(function(e){t.isChanged=!0}),t.phone.subscribe(function(e){t.isChanged=!0}),t.isActive.subscribe(function(e){t.isChanged=!0})},s=function(e,t){var n=this;n._id=i.observable(e?e._id:""),n.name=i.observable(e?e.name:""),n.createDate=e&&e.createDate?e.createDate:"",n.isActive=i.observable(!(!e||!e.isActive)),n.mailType=e&&e.mailType?e.mailType:"",n.mailDisplayType=function(e){return"sf"==e?"顺丰":"common"==e?"韵达":void 0},n.displayPrintName=function(e){e=e();var t="";return""==e?"":"sf"==n.mailType?(t="顺丰",e+" - "+t):"common"==n.mailType?(t="韵达",e+" - "+t):e},e&&Array.isArray(e.addresses)&&e.addresses.length>0?n.addresses=i.observableArray(e.addresses.map(function(e){return new r(e)})):n.addresses=i.observableArray([new r({isActive:!0})]),n.isChanged=!1,n.name.subscribe(function(e){n.isChanged=!0}),n.addresses.subscribe(function(e){n.isChanged=!0}),n.addAddress=function(){n.addresses().length>0?n.addresses.unshift(new r):n.addresses.unshift(new r({isActive:!0})),t.update()},n.removeAddress=function(e){n.addresses.remove(e),t.update()},n.markDefault=function(e,t){t.addresses().forEach(function(e){return e.isActive(!1)}),e.isActive(!0)}};return function(e,o){function a(){var e=p.clients(),t=e.filter(function(e){e.name();return e.isActive()&&"common"==e.mailType}),n=t.filter(function(e){var t=e.name();return t.indexOf("-")>=0||t.indexOf("－")>=0}),i=[];n.forEach(function(e){var t=e.name(),n=t.indexOf("-"),r=t.indexOf("－"),s=-1;s=n>-1&&r>-1?Math.min(n,r):n>-1?n:r;var o=t.slice(0,s);i.find(function(e){return e==o})||i.push(o)});var r=[];i.forEach(function(e){var t=n.filter(function(t){return t.name().startsWith(e)}),i=c(e,t);r.push(i)});var s=t.filter(function(e){var t=e.name();return t.indexOf("-")==-1&&t.indexOf("－")==-1});if(Array.isArray(s)&&s.length>0){var o=c("自己的",s);r.push(o)}return r}function c(e,t){var n="";return t.forEach(function(e){var t=e.addresses().find(function(e){return e.isActive()});if(t){var i=t.recipient(),r=t.phone(),s=t.address();i&&r&&s&&(n+=t.recipient()+"，"+t.phone()+"，"+t.address()+"；")}}),{name:e+"：",receives:n}}function u(e){var t=[];return e.forEach(function(e){t.push(new s(e,o))}),t}function l(){setTimeout(function(){o.update()},100)}function d(){var e=m.filter(function(e){return e.name().indexOf(h)>=0});p.clients(e)}function f(){var e=setTimeout(function(){for(var e=1;e<y.length;e++)clearTimeout(y[e]);y=[],""!=h&&(n.ajax("./clientsByKeywords",{data:{keywords:h},type:"GET",success:function(e,t){/^\s?$/.test(h)||p.clients(u(e))},dataType:"json"}),console.log("i am searching "+h))
},1e3);y.push(e)}var p=this;p.clients=i.observableArray(u(e)),p.senders=i.observableArray(a()),p.setClients=function(e){p.clients(u(e)),p.senders(a())},p.setClientViews=function(e){p.clients(e)},p.setSenders=function(){p.senders(a())},p.addClient=function(){p.clients.unshift(new s(null,o)),l()},p.removeClient=function(e){arguments[3]();var t=arguments[4],i=e._id();if(p.clients.remove(e),""==i)return o.update(),void t();n.ajax("./client/"+i,{success:function(e,n){t(),l()},dataType:"json",type:"DELETE"}),g=!!v},p.submitClients=function(e){arguments[3]();var t=arguments[4],s=p.clients();if(Array.isArray(s)&&s.length>0){var o=[],a=s.filter(function(e,t){var n=!1;if(""!=e.name)if(e.isChanged)n=!0;else{var i=e.addresses(),r=i.find(function(e){return e.isChanged});r&&(n=!0)}return n&&o.push(t),n});if(a.length>0){g=!!v;var c=n.parseJSON(i.toJSON(a));n.post("./clients",{clients:c},function(e,a){e.forEach(function(e,t){var a=o[t];n.isArray(e.addresses)&&0==e.addresses.length&&(e.addresses=[{}]),i.mapping.fromJS(e,{addresses:{create:function(e){return new r(e.data)}}},s[a]),s[a].isChanged=!1}),v||p.setSenders(),t()},"json")}else t()}return!1},p.afterRender=function(){l()},p.afterSenderRender=function(){if(n(".senders").children().length===p.senders().length){new t(".sender-copy",{text:function(e){return n(e).siblings(".sender-receives").val()}});l()}},p.afterClientRender=function(){if(n(".allclients").children().length===p.clients().length){new t(".sender-singleCopy",{text:function(e){var t=n(e).closest(".client").find(".client-address.isActive");return t.find(".recipient>input").val()+"，"+t.find(".phone>input").val()+"，"+t.find(".addressDetail>input").val()+"；"}});l()}};var m,g,v,h,b;p.searchClients=function(e,t){var i=n(t.target).val(),r=i.match(/(\s*)([\u4E00-\u9FA5\uF900-\uFA2D\w]+[\u4E00-\u9FA5\uF900-\uFA2D\w ]*)/);m||(m=p.clients()),null!=r?(v=!0,h=r[2],""==r[1]?d():f()):/^\s?$/.test(i)&&(h="",v=!1,b=!1,g&&!b?(b=!0,n.getJSON("./clientsJson",function(e,t){g=!1,b=!1,p.setClients(e),m=p.clients()})):p.clients(m))};var y=[]}}),define("ProductsModel",["common"],function(e){function t(e){var t=this;t._id=e._id,t.client=e.client,t.name=e.name,t.note=e.note,t.buyPrice=s.observable(e&&!isNaN(e.buyPrice)?e.buyPrice:""),t.sellPrice=s.observable(e&&!isNaN(e.sellPrice)?e.sellPrice:"")}function n(e,n){var i=this;i._id=s.observable(e&&e._id?e._id:""),i.name=s.observable(e&&e.name?e.name:""),i.status=s.observable(e&&e.status?e.status:"MANUAL"),i.buyPrice=s.observable(e&&!isNaN(e.buyPrice)?e.buyPrice:""),i.sellPrice=s.observable(e&&!isNaN(e.sellPrice)?e.sellPrice:""),i.modifiedDate=s.observable(e?e.modifiedDate:""),i.displayDate=s.observable(e?e.displayDate:""),i.isChanged=!1,i.name.subscribe(function(t){i.isChanged=!0,e&&e.name&&t!=e.name&&i.status("MANUAL")}),i.buyPrice.subscribe(function(t){i.isChanged=!0,e&&e.buyPrice&&t!=e.buyPrice&&"MANUAL"!=e.status&&i.status("MODIFIED")}),i.sellPrice.subscribe(function(t){i.isChanged=!0,e&&e.sellPrice&&t!=e.sellPrice&&"MANUAL"!=e.status&&i.status("MODIFIED")}),i.activeClients=s.observableArray([]),i.isOpen=s.observable(!1),i.getActiveClients=function(e,s,o){var a=r(o.target).closest(".table-row").children(".clientInfo");if(i.isOpen())a.slideUp("fast",function(){i.isOpen(!1),n.update()});else{arguments[3]();var c=arguments[4];r.getJSON("./activeClientsByProduct",{product:i.name()},function(e,r){if("success"==r&&Array.isArray(e)&&e.length>0){var s=e.map(function(e){return new t(e)});i.activeClients(s)}else i.activeClients([]);a.slideDown("fast",function(){i.isOpen(!0),c(),n.update()})})}},i.updateClientPrice=function(){arguments[3]();var e=arguments[4],t=i.activeClients(),n=r.parseJSON(s.toJSON(t));return r.post("./updateClientPrice",{clientProducts:n},function(t,n){e()},"json"),!1},i.getExpandCollapse=function(){return i.isOpen()?"icon-collapse":"icon-expand"}}function i(e,t){function i(e){var i=[];if(Array.isArray(e))var i=e.map(function(e){return new n(e,t)});return i}function o(){setTimeout(function(){t.update()},100)}function a(){var e=l.filter(function(e){return e.name().indexOf(p)>=0});u.products(e)}function c(){var e=setTimeout(function(){for(var e=1;e<g.length;e++)clearTimeout(g[e]);g=[],""!=p&&(r.ajax("./productsByKeywords",{data:{keywords:p},type:"GET",success:function(e,t){/^\s?$/.test(p)||u.setProducts(e)},dataType:"json"}),console.log("i am searching "+p))},1e3);g.push(e)}var t=t,u=this;u.setProducts=function(e){u.products(i(e))},u.products=s.observableArray(i(e)),u.submitProducts=function(){arguments[3]();var e=arguments[4],t=u.products(),n=r.parseJSON(s.toJSON(t));if(Array.isArray(n)&&n.length>0){var i=[],o=n.filter(function(e,t){var n=!1;return""!=e.name&&e.isChanged&&(n=!0),n&&i.push(t),n});o.length>0?(d=!!f,r.post("./products",{products:o},function(n,r){n.forEach(function(e,n){var r=i[n];s.mapping.fromJS(e,null,t[r]),t[r].isChanged=!1}),e()},"json")):e()}return!1},u.addProduct=function(){var e=new n(null,t);u.products.unshift(e),o(),r(window).scrollTop(0)},u.removeProduct=function(e){arguments[3]();var t=arguments[4],n=e._id();if(u.products.remove(e),""==n)return void t();r.ajax("./product/"+n,{success:function(e,n){t(),o()},dataType:"json",type:"DELETE"}),d=!!f},u.afterRender=function(){o()},u.afterProductRender=function(){r("#productsbody").children().length===u.products().length&&o()};var l,d,f,p,m;u.searchProducts=function(e,t){var n=r(t.target).val(),i=n.match(/(\s*)([\u4E00-\u9FA5\uF900-\uFA2D\w]+[\u4E00-\u9FA5\uF900-\uFA2D\w ]*)/);l||(l=u.products()),null!=i?(f=!0,p=i[2],""==i[1]?a():c()):/^\s?$/.test(n)&&(p="",f=!1,m=!1,d&&!m?(m=!0,r.getJSON("./productsJson",function(e,t){d=!1,m=!1,u.setProducts(e),l=u.products()})):u.products(l))};var g=[]}var r=e.$,s=e.ko;return s.mapping=e.mapping,i}),define("../js/main",["common","ReceivedOrders","ItemsModel","ReckoningOrders","IncomeList","ClientsModel","ProductsModel"],function(e,t){function n(){function n(e,t,n){var i=n.buyComputing,r=n.sellComputing;"function"==typeof e&&(e=c.mapping.toJS(e())),"function"==typeof t&&(t=c.mapping.toJS(t()));var s=e.filter(function(e){return e.sellPrice||e.buyPrice});return t.forEach(function(e){"1RECEIVED"!=e.status&&"2SENT"!=e.status||e.items.forEach(function(t){var n=s.find(function(e){return e.name==t.name});n&&(r&&!t.sellPrice&&n.sellPrice?(t.sellPrice="?"+n.sellPrice,t.isDoubtSellPrice=!0,e.isChanged=!0):!r&&t.isDoubtSellPrice&&(t.sellPrice=null,t.isDoubtSellPrice=!1),i&&!t.buyPrice&&n.buyPrice?(t.buyPrice="?"+n.buyPrice,t.isDoubtBuyPrice=!0,e.isChanged=!0):!i&&t.isDoubtBuyPrice&&(t.buyPrice=null,t.isDoubtBuyPrice=!1))})}),t}function i(e){switch(a(".swiper-slide")[e].id){case"receivedOrders":l.purchaseItems=!0,l.reckoningOrders=!0,l.clients=!0,l.products=!0;break;case"purchaseItems":l.receivedOrders=!0,l.reckoningOrders=!0;break;case"reckoningOrders":l.receivedOrders=!0,l.purchaseItems=!0,l.incomeList=!0,l.clients=!0,l.products=!0;break;case"products":l.reckoningOrders=!0}}function r(){var e=a(".swiper-slide")[d.activeIndex].id;"receivedOrders"==e&&a.getJSON("./receivedOrdersJson",function(e,t){h.setOrders(e,!0)}),"reckoningOrders"==e&&p.setOrders()}function s(){var e=a(".swiper-slide")[d.activeIndex].id;"incomeList"!=e&&"reckoningOrders"!=e||h.setOrders(orders,!0),"receivedOrders"!=e&&"reckoningOrders"!=e||a.getJSON("./purchaseItemsJson",function(e,t){f.setItems(e.items,!0,!0)}),"receivedOrders"!=e&&"incomeList"!=e||p.setOrders(),"reckoningOrders"==e&&a.getJSON("./incomeListJson",function(e,t){m.setIncomeList(e)}),"reckoningOrders"==e&&a.getJSON("./clientsJson",function(e,t){g.setClients(e)})}function o(){return new Promise(function(e,t){a.getJSON("./user/"+USER_ID,function(t,n){e(t)})})}var a=e.$,c=e.ko,u=(e.mapping,e.Swiper),l={receivedOrders:!1,purchaseItems:!1,reckoningOrders:!1,incomeList:!1,clients:!1,products:!1},d=new u(".swiper-container",{autoHeight:!0,spaceBetween:30,pagination:".swiper-pagination",paginationClickable:!0,simulateTouch:!1,shortSwipes:!1,longSwipes:!1,paginationBulletRender:function(e,t){var n="";switch(a(".swiper-slide")[e].id){case"receivedOrders":n="接单";break;case"purchaseItems":n="采购";break;case"reckoningOrders":n="算账";break;case"incomeList":n="收益";break;case"clients":n="客户";break;case"products":n="产品"}return'<span class="'+t+'">'+n+"</span>"}});e.initTapEvent({updateAllData:s,updateCurrentData:r,setViewModelStatus:i,swiper:d});var f,p,m,g,v,h=new t(orders,d);c.applyBindings(h,a("#receivedOrders")[0]);var b=o();b.catch(function(e){}),require(["common","ItemsModel","ReckoningOrders","IncomeList","ClientsModel","ProductsModel"],function(e,t,r,s,o,a){var c=e.$,u=e.ko,y=new Promise(function(e,n){c.getJSON("./purchaseItemsJson",function(n,i){f=new t(n.items,d),u.applyBindings(f,c("#purchaseItems")[0]),e(f)})});Promise.all([b,y]).then(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1],s=Array.isArray(n.tags)?n.tags:[];c.fn.tag.setGlobalSettings({tags:s,updateTag:function(e,t,n){if(t!=n){if(Array.isArray(r.allItems)&&r.allItems.length>0){var s=r.allItems.find(function(t){return t._id==e});if(s){s.tag=n;var o=[];r.allItems.forEach(function(e){o.indexOf(e.tag)<0&&e.tag&&o.push(e.tag)}),r.tags(o)}}c.post("./itemtag",{itemName:e,oldTag:t,newTag:n},function(e,t){i(d.activeIndex)},"json")}}})});var S;access.products&&(S=new Promise(function(e,t){c.getJSON("./productsJson",function(t,n){e(t),v=new a(t,d),u.applyBindings(v,c("#products")[0])})}));new Promise(function(e,t){function i(t){p=new r(t,d),e(p),u.applyBindings(p,c("#reckoningOrders")[0])}c.getJSON("./reckoningOrdersJson",function(e,t){access.products?Promise.all([b,S]).then(function(t){var r=_slicedToArray(t,2),s=r[0];i(n(r[1],e,{buyComputing:s.buyComputing,sellComputing:s.sellComputing}))}):i(e)})});c.getJSON("./incomeListJson",function(e,t){m=new s(e,d),u.applyBindings(m,c("#incomeList")[0])}),access.clients&&c.getJSON("./clientsJson",function(e,t){g=new o(e,d),u.applyBindings(g,c("#clients")[0])});var C=new Promise(function(e,t){c.getJSON("./allProductsDropdownJson",function(t,n){e(t)})});Promise.all([b,C]).then(function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1];c.fn.dropdown.settings.products=i,c.fn.dropdown.settings.productNames=i.map(function(e){return e.name}),c.fn.dropdown.settings.buyComputing=n.buyComputing,c.fn.dropdown.settings.sellComputing=n.sellComputing}),new Promise(function(e,t){c.getJSON("./allClientNamesJson",function(t,n){e(t)})}).then(function(e){c.fn.dropdown.settings.clients=e}),c(".swiper-wrapper").on("keydown",function(e){if(13==e.keyCode){var t=c(".swiper-slide")[d.activeIndex].id,n=c("#"+t+" .action-enter");return n.length>0&&(c(document.activeElement).blur(),setTimeout(function(){n.trigger("click")},100)),!1}}),d.params.onSlideChangeStart=function(e){switch(c(".swiper-slide")[e.activeIndex].id){case"receivedOrders":l.receivedOrders&&(h.setOrders(orders,!0),l.receivedOrders=!1);break;case"purchaseItems":l.purchaseItems&&c.getJSON("./purchaseItemsJson",function(e,t){f.setItems(e.items,!0,!0),l.purchaseItems=!1});break;case"reckoningOrders":if(l.reckoningOrders){if(access.products)b.then(function(e){p.setOrders(function(t){return n(v.products,t,{buyComputing:e.buyComputing,sellComputing:e.sellComputing})})});else{var t=p.getObservableOrders(orders);p.orders(t)}l.reckoningOrders=!1}break;case"incomeList":l.incomeList&&c.getJSON("./incomeListJson",function(e,t){m.setIncomeList(e),l.incomeList=!1});break;case"clients":l.clients&&c.getJSON("./clientsJson",function(e,t){g.setClients(e),l.clients=!1});break;case"products":l.products&&c.getJSON("./productsJson",function(e,t){v.setProducts(e),l.products=!1})}setTimeout(function(){e.update(),c(window).scrollTop(0)},100)}}),require(["angularApp"],function(e){e().bootstrap(a("#settings")[0],["settings"]),a(".icon-cog").colorbox({inline:!0,width:335,height:200,scrolling:!1,close:"",top:0,onComplete:function(){setInterval(function(){a.colorbox.resize()},200)},onClosed:function(){b=o(),"reckoningOrders"==a(".swiper-slide")[d.activeIndex].id&&access.products&&b.then(function(e){a.fn.dropdown.settings.buyComputing=e.buyComputing,a.fn.dropdown.settings.sellComputing=e.sellComputing,p.setOrders(function(t){return n(v.products,t,{buyComputing:e.buyComputing,sellComputing:e.sellComputing})})}),b.then(function(e){a.fn.tag.setTags(e.tags)})}}),a(window).scroll(function(){var e=a(window).scrollTop();a(".searchbox").css("top",e)})}),a(".icon-signout").bind("click",function(){return a(".mask").addClass("isLoginShow"),a.get("./logout",function(e,t){e.success&&(d.destroy(!0,!0),a.get("./content",function(e,t){setTimeout(function(){a("#container").html(e),a(".mask").removeClass("isLoginShow")},1e3)},"html"))},"json"),!1})}return n});